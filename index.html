<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CorAlma — Encuentra tu calma (Completo)</title>
<meta name="description" content="CorAlma — meditaciones, tarot, oráculo de ángeles, playlists y artículos. Código completo." />
<style>
:root{
  --bg1:#020414; --bg2:#041428;
  --accent1:#6ec6d9; --accent2:#8a6cff;
  --glass: rgba(255,255,255,0.04);
  --muted:#9fd8ea; --text:#e6f9ff;
  --finished:#ff6b6b;
  --card-back: linear-gradient(135deg,#07192a,#1a1133);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; -webkit-font-smoothing:antialiased}
body{
  color:var(--text);
  background:
    radial-gradient(circle at 10% 10%, rgba(138,108,255,0.06), transparent 6%),
    radial-gradient(circle at 90% 70%, rgba(110,198,217,0.04), transparent 10%),
    linear-gradient(180deg,var(--bg1), var(--bg2));
  min-height:100vh;
  background-size: 200% 200%;
  animation: aurora 28s ease-in-out infinite;
}
@keyframes aurora { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

.container{max-width:1180px;margin:24px auto;padding:18px}
header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;font-weight:700;color:#021018}
nav{display:flex;gap:10px;align-items:center}
nav a{color:#cfeffb;text-decoration:none;padding:8px 10px;border-radius:9px}
nav a:hover{background:var(--glass);}

/* grid layout */
.grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-top:22px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:16px;border-radius:12px}
.med-card{padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);box-shadow:0 10px 40px rgba(15,30,50,0.45)}
.center{display:flex;flex-direction:column;align-items:center;gap:12px}
.selector-row{display:flex;gap:10px;align-items:center;width:100%;justify-content:center;flex-wrap:wrap}
select,input,button{background:transparent;color:#dff8ff;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)}
.btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#021018;padding:8px 12px;border-radius:10px;border:0;font-weight:700;cursor:pointer}

/* timer / circle */
.med-circle{width:160px;height:160px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent2),var(--accent1));color:#021018;font-weight:700;font-size:16px;cursor:pointer;box-shadow:0 12px 40px rgba(60,80,120,0.18);transition:transform .12s,border-color .2s}
.med-circle:hover{transform:scale(1.03)}
.time-display{font-weight:700}

/* tarot / oracle */
.deck { width:220px; height:320px; border-radius:14px; display:flex;align-items:center;justify-content:center;background:var(--card-back); color:#cfeffb; font-weight:700; cursor:pointer; position:relative; box-shadow: 0 12px 40px rgba(60,80,120,0.18); transition: transform .18s; }
.deck:hover{ transform: translateY(-6px); }
.reveal { width:320px; margin-top:12px; }
.card-reveal { width:320px;height:460px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2)); padding:12px; box-shadow:0 18px 60px rgba(0,0,0,0.6); position:relative; overflow:hidden; }
.card-reveal img { width:100%; height:auto; border-radius:10px; display:block; max-height:300px; object-fit:cover }
.card-title { font-weight:800; font-size:18px; margin-top:10px; color:#eaf9ff; text-align:center; }
.card-desc { margin-top:8px; font-size:14px; color:#dff8ff; max-height:120px; overflow:auto; text-align:left; padding-right:8px; }

/* inverted badge */
.inverted-badge { position:absolute; left:12px; top:12px; background:rgba(255,255,255,0.06); padding:6px 10px; border-radius:10px; font-size:13px; color:#ffd7a8; }

/* soft animated frame */
.glow-frame { position:absolute; inset:0; border-radius:14px; pointer-events:none; box-shadow: 0 0 40px rgba(110,198,217,0.07), inset 0 0 30px rgba(138,108,255,0.04); animation: slowPulse 4s ease-in-out infinite; }
@keyframes slowPulse { 0%{filter:blur(2px);opacity:.85} 50%{filter:blur(10px);opacity:1} 100%{filter:blur(2px);opacity:.85} }

/* playlists */
.playlist-row{display:flex;gap:14px;flex-wrap:wrap;margin-top:12px}
.pl-card{width:320px;background:rgba(255,255,255,0.02);border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:8px;align-items:flex-start}
.pl-iframe{width:100%;height:180px;border-radius:8px;overflow:hidden}

/* articles */
.articles-grid{display:grid;grid-template-columns:repeat(1,1fr);gap:12px;margin-top:12px}
.article-item{padding:12px;border-radius:10px;background:rgba(255,255,255,0.01);text-align:left}
.article-item h4{margin:0 0 6px 0}
.article-item p{margin:0;color:#cfeef7}

/* floating draggable timer */
.floating-btn{position:fixed;right:20px;bottom:20px;width:120px;height:120px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent2),var(--accent1));color:#021018;font-weight:700;cursor:move;z-index:3000;box-shadow:0 12px 40px rgba(60,80,120,0.18);transition:background .25s}
.floating-btn.finished{background:var(--finished); color:#fff;}
.floating-label{font-size:13px}
.floating-time{font-size:14px;margin-top:6px}

/* FAB + menu */
.fab { position: fixed; bottom: 28px; right: 28px; width:64px;height:64px;border-radius:50%; background: linear-gradient(135deg,#6ec6d9,#8a6cff); display:flex;align-items:center;justify-content:center; color:#021018; font-weight:800; z-index:5000; box-shadow:0 12px 40px rgba(60,80,120,0.2); cursor:pointer; transition: transform .18s; }
.fab:hover{ transform: scale(1.06) rotate(8deg); }
.fab .plus{ font-size:34px;color:#021018; }
.fab-menu { position: fixed; bottom: 100px; right: 28px; display:flex; flex-direction:column; gap:12px; align-items:flex-end; opacity:0; pointer-events:none; transition: opacity .18s; z-index:4900; }
.fab-menu.show{ opacity:1; pointer-events:auto; }
.fab-item { width:54px;height:54px;border-radius:10px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center; text-decoration:none; color:#dff8ff; box-shadow:0 8px 20px rgba(0,0,0,0.35); border:1px solid rgba(255,255,255,0.03); }
.fab-item:hover{ transform:translateY(-6px); background:rgba(255,255,255,0.06); }

/* small helpers */
.hint{font-size:13px;color:#bfeffd;margin-top:6px;text-align:center}
.notice{font-size:13px;color:#ffd7a8;background:rgba(0,0,0,0.15);padding:8px;border-radius:8px;margin-top:8px}

/* responsiveness */
@media(max-width:980px){
  .grid{grid-template-columns:1fr}
  .pl-card{width:100%}
}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">CA</div>
        <div>
          <h1 style="margin:0">CorAlma</h1>
          <div style="font-size:12px;color:#bfeffd">Encuentra tu calma en el universo interior</div>
        </div>
      </div>
      <nav>
        <a href="#medit-block">Meditación</a>
        <a href="#tarot-block">Tarot</a>
        <a href="#angels-block">Ángeles</a>
        <a href="#art">Artículos</a>
      </nav>
    </header>

    <section class="card" aria-labelledby="hero-title" style="margin-top:14px">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div>
          <h2 id="hero-title" style="margin:0 0 6px 0">Calma y presencia — prácticas basadas en ciencia y tradición</h2>
          <p style="margin:0;color:#cfeffb">Sonidos, meditaciones, oráculos y artículos. Toca un mazo para sacar una carta; se mostrará un significado breve y enlace a la referencia cuando exista.</p>
        </div>
        <div>
          <button class="btn-primary" onclick="document.getElementById('medit-block').scrollIntoView({behavior:'smooth'})">Iniciar Meditación</button>
        </div>
      </div>
    </section>

    <div class="grid">
      <main>
        <!-- Meditación -->
        <section id="medit-block" class="card med-card" aria-labelledby="medit-title">
          <h3 id="medit-title">Meditación interactiva</h3>
          <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:8px">
            <div class="selector-row">
              <button class="btn-primary" onclick="setTimer(300)">5 min</button>
              <button class="btn-primary" onclick="setTimer(600)">10 min</button>
              <button class="btn-primary" onclick="setTimer(900)">15 min</button>
            </div>
          </div>

          <div style="margin-top:14px" class="center">
            <div id="medCircle" class="med-circle" role="button" tabindex="0">Tocar</div>
            <div id="timeDisplay" class="time-display" style="margin-top:10px">00:00</div>
            <div class="hint">Temporizador sincronizado con el botón flotante.</div>
          </div>
        </section>

        <!-- Tarot -->
        <section id="tarot-block" class="card" style="margin-top:16px">
          <h3 style="margin-top:0">Tarot — toca solo el mazo</h3>
          <div style="display:flex;gap:20px;align-items:flex-start">
            <div>
              <div id="tarotDeck" class="deck" title="Toca para sacar una carta" aria-label="Mazo Tarot">Mazo Tarot<div class="glow-frame" aria-hidden="true"></div></div>
              <div id="tarotHint" class="hint" style="margin-top:8px">Mostraré resumen breve y enlace a Wikipedia si existe.</div>
            </div>

            <div>
              <div id="tarotReveal" class="reveal" style="display:none" aria-live="polite">
                <div class="card-reveal">
                  <div id="tarotInvertBadge" class="inverted-badge" style="display:none">Invertida</div>
                  <img id="tarotImg" src="" alt="Carta tarot" style="display:block;border-radius:10px;max-height:300px;object-fit:cover" />
                  <div id="tarotName" class="card-title">Nombre carta</div>
                  <div id="tarotText" class="card-desc">Significado breve...</div>
                  <div style="margin-top:8px;text-align:center"><a id="tarotLink" href="#" target="_blank" style="color:#bfeffd;font-size:13px;text-decoration:underline">Leer referencia</a></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Angels -->
        <section id="angels-block" class="card" style="margin-top:16px">
          <h3 style="margin-top:0">Oráculo — Ángeles</h3>
          <div style="display:flex;gap:20px;align-items:flex-start">
            <div>
              <div id="angelsDeck" class="deck" title="Toca para recibir un mensaje angelical" aria-label="Mazo Ángeles">Mazo Ángeles<div class="glow-frame" aria-hidden="true"></div></div>
              <div class="hint" style="margin-top:8px">Cartas angelicales con mensaje y referencia cuando exista.</div>
            </div>
            <div>
              <div id="angelReveal" class="reveal" style="display:none" aria-live="polite">
                <div class="card-reveal">
                  <img id="angelImg" src="" alt="Ángel" style="display:block;border-radius:10px;max-height:300px;object-fit:cover" />
                  <div id="angelName" class="card-title">Ángel</div>
                  <div id="angelText" class="card-desc">Mensaje...</div>
                  <div style="margin-top:8px;text-align:center"><a id="angelLink" href="#" target="_blank" style="color:#bfeffd;font-size:13px;text-decoration:underline">Ver fuente</a></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Playlists -->
        <section class="card" style="margin-top:16px">
          <h3 style="margin-top:0">Playlists (YouTube)</h3>
          <div id="playlistRow" class="playlist-row" aria-live="polite">
            <!-- three embedded playlists -->
            <div class="pl-card">
              <div class="pl-iframe">
                <iframe width="100%" height="180" src="https://www.youtube.com/embed/videoseries?list=PL6FMHId50GbE14ydduaNffH9ZCwpIOKpS" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
              </div>
              <a class="pl-title" href="https://youtube.com/playlist?list=PL6FMHId50GbE14ydduaNffH9ZCwpIOKpS" target="_blank">Playlist: Relajación / 1</a>
            </div>

            <div class="pl-card">
              <div class="pl-iframe">
                <iframe width="100%" height="180" src="https://www.youtube.com/embed/videoseries?list=PL6FMHId50GbE14ydduaNffH9ZCwpIOKpS" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
              </div>
              <a class="pl-title" href="https://youtube.com/playlist?list=PL6FMHId50GbE14ydduaNffH9ZCwpIOKpS" target="_blank">Playlist: Relajación / 2</a>
            </div>

            <div class="pl-card">
              <div class="pl-iframe">
                <iframe width="100%" height="180" src="https://www.youtube.com/embed/videoseries?list=PL6FMHId50GbGGi06g4gMUzsfMNveEKNxQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
              </div>
              <a class="pl-title" href="https://youtube.com/playlist?list=PL6FMHId50GbGGi06g4gMUzsfMNveEKNxQ" target="_blank">Playlist: Relajación / 3</a>
            </div>
          </div>
          <div class="hint">Pulsa play en cualquiera y la reproducción sucede dentro de la página.</div>
        </section>

        <!-- Articles -->
        <section id="art" class="card" style="margin-top:16px">
          <h3 style="margin-top:0">Artículos / Referencias</h3>
          <div id="articlesList" class="articles-grid">
            <div class="article-item">Cargando artículos...</div>
          </div>
          <div class="hint">Los 5 primeros artículos incluyen enlace de referencia (Wikipedia).</div>
        </section>
      </main>

      <aside>
        <div class="side-block">
          <div class="card">
            <h4 style="margin-top:0">Frases diarias</h4>
            <div id="fraseBox" style="font-size:15px;background:rgba(255,255,255,0.02);padding:12px;border-radius:8px">Cargando...</div>
            <div class="hint">Una frase para el día (rotación entre 30 frases).</div>
          </div>

          <div class="card" id="reg" style="margin-top:12px">
            <h4 style="margin-top:0">Registro / Frase mensual</h4>
            <form id="subForm">
              <input id="emailInput" type="email" placeholder="tu@correo.com" required style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#dff8ff">
              <div style="margin-top:10px"><button class="btn-primary" type="submit">Suscribirme</button></div>
            </form>
            <div id="subInfo" style="margin-top:12px;color:#bfeffd"></div>
          </div>

          <div class="card" id="don" style="margin-top:12px">
            <h4 style="margin-top:0">Donaciones</h4>
            <p style="margin:0 0 10px 0;color:#cfeef7">Si valoras este proyecto, apóyalo.</p>
            <!-- PayPal link with your hosted_button_id -->
            <a class="btn-primary" id="paypalBtn" href="https://www.paypal.com/donate/?hosted_button_id=GW4XCFHYRTJQQ" target="_blank" rel="noopener">Donar con PayPal</a>
          </div>
        </div>
      </aside>
    </div>

    <footer id="contact" style="margin-top:20px">
      <div style="color:#9fd8ea">Contacto: <a href="mailto:almacoralma@gmail.com">almacoralma@gmail.com</a></div>
    </footer>
  </div>

  <!-- floating synchronized timer -->
  <div id="floatingBtn" class="floating-btn" title="Arrástrame" role="button" aria-label="Temporizador">
    <div id="floatingLabel" class="floating-label">Meditación</div>
    <div id="floatingTime" class="floating-time">00:00</div>
  </div>

  <!-- FAB + menu -->
  <div class="fab" id="fabBtn" aria-label="Más">
    <div class="plus">+</div>
  </div>
  <div class="fab-menu" id="fabMenu" aria-hidden="true">
    <!-- Instagram -->
    <a class="fab-item" href="https://www.instagram.com/effectno33?igsh=MjAycWE4dTFsbXpw" target="_blank" rel="noopener" title="Instagram" aria-label="Instagram">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 6.1a4.9 4.9 0 1 0 .001 9.8A4.9 4.9 0 0 0 12 8.1zM18.4 5.6a1.1 1.1 0 1 0 0 2.2 1.1 1.1 0 0 0 0-2.2z" fill="#fff"/></svg>
    </a>
    <!-- TikTok -->
    <a class="fab-item" href="https://www.tiktok.com/@effect.33?_t=ZS-8zoEWdno7UL&_r=1" target="_blank" rel="noopener" title="TikTok" aria-label="TikTok">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 3v10.5A4.5 4.5 0 1 0 13.5 18V7h3V3h-7z" fill="#fff"/></svg>
    </a>
    <!-- YouTube -->
    <a class="fab-item" href="https://youtube.com/@effect.no33?si=1etVu0OT8KashHWN" target="_blank" rel="noopener" title="YouTube" aria-label="YouTube">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M10 15l5.2-3L10 9v6zM21 8s-.2-1.4-.8-2a3.2 3.2 0 0 0-2.2-.9C15.6 5 12 5 12 5s-3.6 0-5.9.1c-.8 0-1.6.3-2.2.9A4 4 0 0 0 3 8c-.6.6-.8 2-.8 2S2 9.8 2 11.6v.8C2 14.2 2.2 15 2.2 15s.2 1.4.8 2a3.2 3.2 0 0 0 2.2.9C8.4 19 12 19 12 19s3.6 0 5.9-.1c.8 0 1.6-.3 2.2-.9.6-.6.8-2 .8-2s.2-.8.2-2.6v-.8C22 9.8 21.8 9 21.8 9s-.2-1.4-.8-2z" fill="#fff"/></svg>
    </a>
    <!-- PayPal -->
    <a class="fab-item" href="https://www.paypal.com/donate/?hosted_button_id=GW4XCFHYRTJQQ" target="_blank" rel="noopener" title="Donar (PayPal)" aria-label="PayPal">
      <!-- stylized P -->
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 7h5.5c2.5 0 4-1.9 4-4.2C16.5 1.6 14.5 0 11.6 0H6.2C5 0 4 1 4 2.2v15.6C4 19.9 5 21 6.2 21h6.3c4.4 0 6.5-2.6 6.5-6 0-2.1-1.1-3.6-2.6-4.3-.3-.1-.7.1-.7.4v.2c0 1.2-.7 2.2-1.9 2.2H9.4V7z" fill="#fff"/></svg>
    </a>
  </div>

<script>
/* ----------------- Short helpers ----------------- */
const $ = id => document.getElementById(id);

/* ---------- Timer & floating sync ---------- */
let timerSec = 300;
let timerInterval = null;
function pad(n){ return String(n).padStart(2,'0'); }
function updateDisplays(){
  const m = Math.floor(timerSec/60), s = timerSec%60;
  const text = `${pad(m)}:${pad(s)}`;
  const td = $('timeDisplay'); if(td) td.textContent = text;
  $('floatingTime').textContent = text;
  if(timerSec<=0) $('floatingBtn').classList.add('finished'); else $('floatingBtn').classList.remove('finished');
}
function setTimer(sec){ timerSec = sec; updateDisplays(); }
function startTimer(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=> {
    if(timerSec>0){ timerSec--; updateDisplays(); } else { clearInterval(timerInterval); timerInterval=null; updateDisplays(); try{ new Audio('https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg').play().catch(()=>{}); }catch(e){} }
  },1000);
}
function stopTimer(){ if(timerInterval) clearInterval(timerInterval); timerInterval=null; updateDisplays(); }
$('medCircle').addEventListener('click', ()=> { if(timerInterval) stopTimer(); else startTimer(); });
$('floatingBtn').addEventListener('click', ()=> { if(timerInterval) stopTimer(); else startTimer(); });
updateDisplays();

/* Drag floating */
let isDragging=false, offX=0, offY=0;
const floating = $('floatingBtn');
floating.addEventListener('mousedown', e => { isDragging=true; offX = e.clientX - floating.offsetLeft; offY = e.clientY - floating.offsetTop; e.preventDefault(); });
document.addEventListener('mousemove', e => { if(!isDragging) return; floating.style.left=(e.clientX-offX)+'px'; floating.style.top=(e.clientY-offY)+'px'; });
document.addEventListener('mouseup', ()=> isDragging=false);
floating.addEventListener('touchstart', e=>{ isDragging=true; const t=e.touches[0]; offX=t.clientX-floating.offsetLeft; offY=t.clientY-floating.offsetTop; });
document.addEventListener('touchmove', e=>{ if(!isDragging) return; const t=e.touches[0]; floating.style.left=(t.clientX-offX)+'px'; floating.style.top=(t.clientY-offY)+'px'; });
document.addEventListener('touchend', ()=> isDragging=false);

/* ----------------- Frases diarias ----------------- */
const PHRASES = [
  "Respira profundo; todo está bien ahora.",
  "Deja que el silencio te muestre lo esencial.",
  "Hoy es un paso más en tu camino.",
  "La calma se construye con pequeñas pausas.",
  "Siente el presente sin juzgarlo.",
  "Confía en tu ritmo interior.",
  "Una sonrisa cambia la vibración del día.",
  "Suéltalo; no necesitas sostenerlo todo.",
  "Eres suficiente tal como eres.",
  "Escucha lo que tu cuerpo susurra.",
  "Permítete descansar sin culpa.",
  "La gratitud hace crecer lo que aprecias.",
  "Un pensamiento amable hacia ti, ahora.",
  "Cada inhalación trae claridad.",
  "Cultiva paciencia; todo tiene su tiempo.",
  "Abraza la incertidumbre con curiosidad.",
  "Tu corazón sabe más de lo que imagina la mente.",
  "Pequeños actos de cuidado, gran efecto.",
  "La naturaleza te recuerda tu origen.",
  "Hoy elige lo que nutre tu paz.",
  "Acepta lo que no puedes cambiar, transforma lo que sí.",
  "Observa sin reaccionar.",
  "Tu respiración es un ancla siempre disponible.",
  "Permite que la compasión te guíe.",
  "Regala silencio a tu mente.",
  "Siente tus pies en el suelo; estás aquí.",
  "Nadie espera que seas perfecto.",
  "Renueva tu energía con un gesto amable.",
  "Tu pausa de hoy es tu impulso de mañana.",
  "La serenidad se construye instante a instante."
];
(function showDailyPhrase(){ const idx = (new Date().getDate() + new Date().getMonth()) % PHRASES.length; $('fraseBox').textContent = PHRASES[idx]; })();

/* ----------------- Articles: 5 wiki topics ES first ----------------- */
const ARTICLE_TOPICS = ['Meditación','Mindfulness','Neurociencia','Relajación','Gratitud'];
async function loadArticles(){
  try{
    const container = $('articlesList'); container.innerHTML='';
    for(const t of ARTICLE_TOPICS.slice(0,5)){
      let chosen = t;
      // search ES
      try{
        const searchUrl = `https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(t)}&format=json&origin=*`;
        const res = await fetch(searchUrl);
        if(res.ok){
          const j = await res.json();
          if(j.query && j.query.search && j.query.search[0]) chosen = j.query.search[0].title;
        }
      }catch(e){}
      let summary = null;
      try{
        const summUrl = `https://es.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(chosen)}`;
        const rr = await fetch(summUrl);
        if(rr.ok) summary = await rr.json();
      }catch(e){}
      const item = document.createElement('div'); item.className='article-item';
      const title = summary && summary.title ? summary.title : chosen;
      const txt = summary && summary.extract ? (summary.extract.length>260?summary.extract.slice(0,260)+'...':summary.extract) : 'Resumen no disponible.';
      const href = summary && summary.content_urls && summary.content_urls.desktop ? summary.content_urls.desktop.page : (`https://es.wikipedia.org/w/index.php?search=${encodeURIComponent(chosen)}`);
      item.innerHTML = `<h4>${title}</h4><p>${txt}</p><div style="margin-top:8px"><a href="${href}" target="_blank" style="color:#bfeffd;text-decoration:underline">Leer referencia</a></div>`;
      container.appendChild(item);
    }
  }catch(e){
    $('articlesList').innerHTML = '<div class="article-item">No fue posible cargar artículos.</div>';
  }
}
loadArticles();

/* ----------------- Tarot & Deck setup ----------------- */
const MAJOR_ARCANA = [
  "El Loco","El Mago","La Sacerdotisa","La Emperatriz","El Emperador",
  "El Sumo Sacerdote","Los Enamorados","El Carro","La Fuerza","El Ermitaño",
  "La Rueda de la Fortuna","La Justicia","El Colgado","La Muerte","La Templanza",
  "El Diablo","La Torre","La Estrella","La Luna","El Sol","El Juicio","El Mundo"
];
const SUITS = ["Copas","Oros","Espadas","Bastos"];
const RANKS = ["As","Dos","Tres","Cuatro","Cinco","Seis","Siete","Ocho","Nueve","Diez","Sota","Caballero","Reina","Rey"];
function buildFullDeck(){ const deck=[...MAJOR_ARCANA]; for(const s of SUITS){ for(const r of RANKS) deck.push(`${r} de ${s}`); } return deck; }
const FULL_DECK = buildFullDeck();
const CARD_MEANINGS = {
  "El Loco":"Nuevos comienzos, espontaneidad y fe. Invertido: imprudencia o falta de rumbo.",
  "El Mago":"Voluntad, habilidades y manifestación. Invertido: dispersión o manipulación.",
  "La Sacerdotisa":"Intuición, misterio, sabiduría interior.",
  "La Emperatriz":"Fertilidad, creatividad, abundancia.",
  "El Emperador":"Orden, estructura, autoridad.",
  "El Sumo Sacerdote":"Tradición, guía espiritual, enseñanza.",
  "Los Enamorados":"Elecciones del corazón, relaciones, unión.",
  "El Carro":"Voluntad y triunfo sobre obstáculos.",
  "La Fuerza":"Coraje, dominio interior y compasión.",
  "El Ermitaño":"Reflexión, búsqueda interior y retiro.",
  "La Rueda de la Fortuna":"Ciclos, cambios y destino.",
  "La Justicia":"Equilibrio, responsabilidad y verdad.",
  "El Colgado":"Entrega, pausa y cambio de perspectiva.",
  "La Muerte":"Transformación y cierre necesario.",
  "La Templanza":"Equilibrio, moderación y armonía.",
  "El Diablo":"Ligaduras, sombra y ataduras a superar.",
  "La Torre":"Caída de estructuras, despertar brusco.",
  "La Estrella":"Esperanza, renovación y guía.",
  "La Luna":"Inconsciente, sueños y ambigüedad.",
  "El Sol":"Éxito, claridad y vitalidad.",
  "El Juicio":"Renacimiento, llamado y evaluación.",
  "El Mundo":"Culminación, realización e integración."
};
function minorMeaning(rank,suit){ const keys = {"Copas":"emociones","Oros":"lo material","Espadas":"la mente","Bastos":"acción"}; const rnum = {"As":"nuevo inicio","Dos":"asociación","Tres":"crecimiento","Cuatro":"estabilidad","Cinco":"conflicto","Seis":"transición","Siete":"defensa","Ocho":"rapidez","Nueve":"preocupación","Diez":"culminación","Sota":"mensaje","Caballero":"movimiento","Reina":"madurez","Rey":"dominio"}; const base = rnum[rank]||rank.toLowerCase(); return `${base} en el área de ${keys[suit]||suit}.`; }

/* Wikipedia summary helper (tries ES then EN) */
async function wikiSummaryFor(query){
  try{
    const sUrl = `https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;
    let res = await fetch(sUrl);
    if(res.ok){ let j = await res.json(); if(j.query && j.query.search && j.query.search.length){ const title = j.query.search[0].title; const summaryUrl = `https://es.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`; const rr = await fetch(summaryUrl); if(rr.ok) return await rr.json(); } }
  }catch(e){}
  try{
    const sUrl = `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;
    let res = await fetch(sUrl);
    if(res.ok){ let j = await res.json(); if(j.query && j.query.search && j.query.search.length){ const title = j.query.search[0].title; const summaryUrl = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`; const rr = await fetch(summaryUrl); if(rr.ok) return await rr.json(); } }
  }catch(e){}
  return null;
}

/* Canvas generator for cards */
function generateCardImage(name, subtitle='', type='tarot', opts={}){
  const w = opts.width||900, h = opts.height||1200;
  const canvas = document.createElement('canvas'); canvas.width=w; canvas.height=h;
  const ctx = canvas.getContext('2d');
  // BG gradient
  const g = ctx.createLinearGradient(0,0,w,h);
  g.addColorStop(0,'#0f0c29'); g.addColorStop(0.5,'#302b63'); g.addColorStop(1,'#24243e');
  ctx.fillStyle = g; ctx.fillRect(0,0,w,h);
  // radial
  const rg = ctx.createRadialGradient(w*0.75,h*0.15,10,w*0.75,h*0.15,h);
  rg.addColorStop(0,'rgba(138,108,255,0.12)'); rg.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle = rg; ctx.fillRect(0,0,w,h);
  // inner rect
  const pad = Math.round(w*0.06); const rx=pad, ry=pad, rw=w-pad*2, rh=h-pad*2;
  ctx.fillStyle='rgba(255,255,255,0.02)'; roundRect(ctx,rx,ry,rw,rh,36,true,false);
  // frame
  drawFrame(ctx,rx,ry,rw,rh);
  // symbol
  drawSymbol(ctx,w/2,ry+Math.round(rh*0.25),Math.round(Math.min(w,rh)*0.12),type,opts.symbol);
  // title
  ctx.fillStyle='#e6f9ff'; ctx.textAlign='center'; ctx.font=`700 ${Math.round(w*0.04)}px Inter, sans-serif`; wrapText(ctx,name,w/2,ry+Math.round(rh*0.6),Math.round(w*0.8),Math.round(w*0.05));
  // subtitle
  if(subtitle){ ctx.fillStyle='rgba(223,248,255,0.9)'; ctx.font=`${Math.round(w*0.026)}px Inter, sans-serif`; wrapText(ctx,subtitle,w/2,ry+Math.round(rh*0.6)+60,Math.round(w*0.76),Math.round(w*0.038)); }
  // footer
  ctx.fillStyle='rgba(191,239,253,0.8)'; ctx.font=`${Math.round(w*0.022)}px Inter, sans-serif`; ctx.fillText('CorAlma — Oráculo', w/2, h-pad+6);
  if(opts.inverted){
    const tmp = document.createElement('canvas'); tmp.width=w; tmp.height=h; const tctx=tmp.getContext('2d');
    tctx.translate(w/2,h/2); tctx.rotate(Math.PI); tctx.translate(-w/2,-h/2); tctx.drawImage(canvas,0,0);
    return tmp.toDataURL('image/png');
  }
  return canvas.toDataURL('image/png');

  function roundRect(ctx,x,y,width,height,radius,fill,stroke){
    if(typeof radius==='undefined') radius=5;
    if(typeof radius==='number') radius={tl:radius,tr:radius,br:radius,bl:radius};
    ctx.beginPath(); ctx.moveTo(x+radius.tl,y); ctx.lineTo(x+width-radius.tr,y); ctx.quadraticCurveTo(x+width,y,x+width,y+radius.tr); ctx.lineTo(x+width,y+height-radius.br);
    ctx.quadraticCurveTo(x+width,y+height,x+width-radius.br,y+height); ctx.lineTo(x+radius.bl,y+height); ctx.quadraticCurveTo(x,y+height,x,y+height-radius.bl); ctx.lineTo(x,y+radius.tl); ctx.quadraticCurveTo(x,y,x+radius.tl,y); ctx.closePath();
    if(fill) ctx.fill(); if(stroke){ ctx.lineWidth=Math.max(3,Math.round(width*0.006)); ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.stroke(); }
  }
  function drawFrame(ctx,x,y,w,h){
    ctx.save(); ctx.lineWidth=Math.max(4,Math.round(w*0.01)); const g=ctx.createLinearGradient(x,y,x+w,y+h); g.addColorStop(0,'rgba(255,220,130,0.95)'); g.addColorStop(0.5,'rgba(255,255,255,0.85)'); g.addColorStop(1,'rgba(255,200,100,0.9)'); ctx.strokeStyle=g; roundRect(ctx,x-8,y-8,w+16,h+16,40,false,true); ctx.restore();
  }
  function drawSymbol(ctx,cx,cy,radius,type,symbol){
    ctx.save();
    const halo=ctx.createRadialGradient(cx,cy,radius*0.2,cx,cy,radius*1.3); halo.addColorStop(0,'rgba(255,255,255,0.14)'); halo.addColorStop(1,'rgba(255,255,255,0)');
    ctx.fillStyle=halo; ctx.beginPath(); ctx.arc(cx,cy,radius*1.25,0,Math.PI*2); ctx.fill();
    ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.font=`${Math.round(radius*1.6)}px serif`; const sym=symbol||(type==='angels'?'👼':'★'); ctx.fillStyle='#fff'; ctx.fillText(sym,cx,cy + (type==='angels'?-6:0)); ctx.restore();
  }
  function wrapText(ctx,text,x,y,maxWidth,lineHeight){
    const words=text.split(' '); let line=''; let lineCount=0;
    for(let n=0;n<words.length;n++){
      const test=line+words[n]+' ';
      if(ctx.measureText(test).width>maxWidth && n>0){ ctx.fillText(line,x,y + (lineCount*lineHeight)); line=words[n]+' '; lineCount++; } else line=test;
    }
    ctx.fillText(line,x,y + (lineCount*lineHeight));
  }
}

/* ----------------- Draw Tarot (single card) ----------------- */
async function drawTarot(){
  const deckEl = $('tarotDeck'), revealBox = $('tarotReveal'), img = $('tarotImg'), nameEl = $('tarotName'), textEl = $('tarotText'), linkEl = $('tarotLink'), invertBadge=$('tarotInvertBadge');
  deckEl.style.transform='translateY(-6px)'; setTimeout(()=>deckEl.style.transform='translateY(0)',160);
  const idx = Math.floor(Math.random()*FULL_DECK.length); const cardName = FULL_DECK[idx]; const inverted = Math.random()<0.45;
  let meaning = CARD_MEANINGS[cardName];
  if(!meaning){ const m=cardName.match(/^(.+?) de (.+)$/); if(m) meaning = minorMeaning(m[1],m[2]); else meaning='Significado general: interpretación simbólica según contexto.'; }
  // try wiki
  let wiki = null;
  try{ wiki = await wikiSummaryFor(cardName + ' tarot') || await wikiSummaryFor(cardName); }catch(e){ wiki=null; }
  let displayed = meaning; if(wiki && wiki.extract) displayed += '\n\nReferencia (Wikipedia): ' + (wiki.extract.length>300?wiki.extract.slice(0,300)+'...':wiki.extract);
  const dataUrl = generateCardImage(cardName, meaning.slice(0,160), 'tarot', {inverted:inverted, symbol:'★', width:800, height:1100});
  img.src = dataUrl; img.style.display='block';
  nameEl.textContent = cardName + (inverted?' (invertida)':'');
  textEl.textContent = displayed;
  linkEl.href = (wiki && wiki.content_urls && wiki.content_urls.desktop && wiki.content_urls.desktop.page) ? wiki.content_urls.desktop.page : ('https://es.wikipedia.org/w/index.php?search='+encodeURIComponent(cardName));
  invertBadge.style.display = inverted ? 'block':'none';
  revealBox.style.display='block'; revealBox.scrollIntoView({behavior:'smooth', block:'center'});
}
$('tarotDeck').addEventListener('click', drawTarot);

/* ----------------- Angels oracle ----------------- */
const ANGEL_ORACLE = [
  {name:'Arcángel Miguel', msg:'Protección, coraje y liberación del miedo.'},
  {name:'Arcángel Gabriel', msg:'Comunicación clara, mensajes y creatividad.'},
  {name:'Arcángel Rafael', msg:'Sanación, cuidado y bienestar físico.'},
  {name:'Arcángel Uriel', msg:'Iluminación, claridad y soluciones prácticas.'},
  {name:'Arcángel Chamuel', msg:'Amor, compasión y reconciliación.'},
  {name:'Arcángel Zadkiel', msg:'Perdón, transformación y misericordia.'},
  {name:'Arcángel Jofiel', msg:'Belleza, inspiración y perspectiva positiva.'},
  {name:'Ángel de la Guarda', msg:'Apoyo cotidiano y guía silenciosa.'},
  {name:'Arcángel Metatrón', msg:'Orden, conexión y registro akáshico.'},
  {name:'Arcángel Raguel', msg:'Armonía en relaciones y justicia.'},
  {name:'Arcángel Haniel', msg:'Intuición, gracia y encanto.'},
  {name:'Arcángel Jeremiel', msg:'Soñar con propósito, revisión de vida.'},
  {name:'Arcángel Ariel', msg:'Naturaleza, abundancia y coraje.'},
  {name:'Arcángel Selaphiel', msg:'Paz, oración y consuelo.'},
  {name:'Arcángel Barachiel', msg:'Bendiciones y gratitud activa.'}
];
async function drawAngel(){
  const deck = $('angelsDeck'), reveal=$('angelReveal'), img=$('angelImg'), nameEl=$('angelName'), textEl=$('angelText'), linkEl=$('angelLink');
  deck.style.transform='translateY(-6px)'; setTimeout(()=>deck.style.transform='translateY(0)',140);
  const idx = Math.floor(Math.random()*ANGEL_ORACLE.length); const card = ANGEL_ORACLE[idx];
  nameEl.textContent = card.name; textEl.textContent = card.msg;
  let wiki = null;
  try{ wiki = await wikiSummaryFor(card.name); }catch(e){ wiki=null; }
  if(wiki && wiki.thumbnail && wiki.thumbnail.source){ img.src = wiki.thumbnail.source; img.style.display='block'; linkEl.href = (wiki.content_urls && wiki.content_urls.desktop && wiki.content_urls.desktop.page) ? wiki.content_urls.desktop.page : '#'; }
  else { const dataUrl = generateCardImage(card.name, card.msg, 'angels', {symbol:'👼', width:800, height:1100}); img.src = dataUrl; img.style.display='block'; linkEl.href = (wiki && wiki.content_urls && wiki.content_urls.desktop && wiki.content_urls.desktop.page) ? wiki.content_urls.desktop.page : '#'; }
  reveal.style.display='block'; reveal.scrollIntoView({behavior:'smooth', block:'center'});
}
$('angelsDeck').addEventListener('click', drawAngel);

/* ----------------- FAB (plus) menu toggle ----------------- */
const fabBtn = $('fabBtn'), fabMenu = $('fabMenu');
fabBtn.addEventListener('click', ()=> {
  const showing = fabMenu.classList.toggle('show');
  fabMenu.setAttribute('aria-hidden', !showing);
  // rotate plus
  fabBtn.style.transform = showing ? 'rotate(45deg) scale(1.02)' : 'rotate(0deg) scale(1)';
});

/* ---------- Subscription form ---------- */
$('subForm').addEventListener('submit', e => { e.preventDefault(); $('subInfo').textContent = '¡Gracias! Te hemos suscrito (demo)'; $('emailInput').value=''; });

/* Prevent selection while dragging floating */
document.addEventListener('touchmove', function(e){ if(isDragging) e.preventDefault(); }, {passive:false});
</script>
</body>
</html>