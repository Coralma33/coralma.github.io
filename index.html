<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CorAlma ‚Äî Encuentra tu calma (Escritorio)</title>
<meta name="description" content="Or√°culo, Tarot, meditaciones, playlists y art√≠culos ‚Äî versi√≥n de escritorio con social bar a la derecha y temporizador flotante sincronizado." />
<style>
:root{
  --bg1:#020414; --bg2:#041428;
  --accent1:#6ec6d9; --accent2:#8a6cff;
  --glass: rgba(255,255,255,0.04);
  --muted:#9fd8ea; --text:#e6f9ff;
  --finished:#ff6b6b;
  --card-back: linear-gradient(135deg,#07192a,#1a1133);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; -webkit-font-smoothing:antialiased}
body{
  color:var(--text);
  background:
    radial-gradient(circle at 10% 10%, rgba(138,108,255,0.06), transparent 6%),
    radial-gradient(circle at 90% 70%, rgba(110,198,217,0.04), transparent 10%),
    linear-gradient(180deg,var(--bg1), var(--bg2));
  min-height:100vh;
  background-size: 200% 200%;
  animation: aurora 28s ease-in-out infinite;
}
@keyframes aurora {
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

.container{max-width:1180px;margin:24px auto;padding:18px}
header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;font-weight:700;color:#021018}
nav{display:flex;gap:10px;align-items:center}
nav a{color:#cfeffb;text-decoration:none;padding:8px 10px;border-radius:9px}
nav a:hover{background:var(--glass);}

/* layout */
.grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-top:22px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:16px;border-radius:12px}
.med-card{padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);box-shadow:0 10px 40px rgba(15,30,50,0.45)}
.center{display:flex;flex-direction:column;align-items:center;gap:12px}
.selector-row{display:flex;gap:10px;align-items:center;width:100%;justify-content:center;flex-wrap:wrap}
select,input,button{background:transparent;color:#dff8ff;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)}
.btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#021018;padding:8px 12px;border-radius:10px;border:0;font-weight:700;cursor:pointer}

/* tarot / oracle */
.deck { width:220px; height:320px; border-radius:14px; display:flex;align-items:center;justify-content:center;background:var(--card-back); color:#cfeffb; font-weight:700; cursor:pointer; position:relative; box-shadow: 0 12px 40px rgba(60,80,120,0.18); transition: transform .18s; }
.deck:hover{ transform: translateY(-6px); }
.reveal { width:280px; margin-top:12px; }
.card-reveal { width:280px;height:420px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2)); padding:12px; box-shadow:0 18px 60px rgba(0,0,0,0.6); position:relative; overflow:hidden; }
.card-reveal img { width:100%; height:auto; border-radius:10px; display:block; max-height:260px; object-fit:cover }
.card-title { font-weight:800; font-size:18px; margin-top:10px; color:#eaf9ff; text-align:center; }
.card-desc { margin-top:8px; font-size:14px; color:#dff8ff; max-height:120px; overflow:auto; text-align:left; padding-right:8px; }

/* inverted badge */
.inverted-badge { position:absolute; left:12px; top:12px; background:rgba(255,255,255,0.06); padding:6px 10px; border-radius:10px; font-size:13px; color:#ffd7a8; }

/* soft animated frame */
.glow-frame { position:absolute; inset:0; border-radius:14px; pointer-events:none; box-shadow: 0 0 40px rgba(110,198,217,0.07), inset 0 0 30px rgba(138,108,255,0.04); animation: slowPulse 4s ease-in-out infinite; }
@keyframes slowPulse { 0%{filter:blur(2px);opacity:.85} 50%{filter:blur(10px);opacity:1} 100%{filter:blur(2px);opacity:.85} }

/* playlists */
.playlist-row{display:flex;gap:14px;flex-wrap:wrap;margin-top:12px}
.pl-card{width:220px;background:rgba(255,255,255,0.02);border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:8px;align-items:flex-start}
.pl-cover{width:200px;height:112px;border-radius:8px;background:linear-gradient(90deg,#000,#222);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
.pl-title{font-size:13px;color:#dff8ff;text-decoration:none}

/* articles */
.articles-grid{display:grid;grid-template-columns:repeat(1,1fr);gap:12px;margin-top:12px}
.article-item{padding:12px;border-radius:10px;background:rgba(255,255,255,0.01);text-align:left}
.article-item h4{margin:0 0 6px 0}
.article-item p{margin:0;color:#cfeef7}

/* floating draggable timer */
.floating-btn{position:fixed;right:20px;bottom:20px;width:120px;height:120px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent2),var(--accent1));color:#021018;font-weight:700;cursor:move;z-index:3000;box-shadow:0 12px 40px rgba(60,80,120,0.18);transition:background .25s}
.floating-btn.finished{background:var(--finished); color:#fff;}
.floating-label{font-size:13px}
.floating-time{font-size:14px;margin-top:6px}

/* social bar (right) */
.social-bar { position:fixed; right:18px; top:50%; transform:translateY(-50%); display:flex; flex-direction:column; gap:12px; z-index:4000; }
.social-btn{width:52px;height:52px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.03),transparent);display:flex;align-items:center;justify-content:center;color:#dff8ff;text-decoration:none;box-shadow:0 8px 30px rgba(0,0,0,0.4); border:1px solid rgba(255,255,255,0.03)}
.social-btn:hover{ transform:translateY(-6px); background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); }

/* PayPal 'P' */
.paypal-p { font-weight:900; font-size:18px; color:#00457C; background:white; width:30px; height:30px; display:flex; align-items:center; justify-content:center; border-radius:6px; }

/* small helpers */
.hint{font-size:13px;color:#bfeffd;margin-top:6px;text-align:center}
.notice{font-size:13px;color:#ffd7a8;background:rgba(0,0,0,0.15);padding:8px;border-radius:8px;margin-top:8px}

/* layout responsive fallback */
@media(max-width:980px){
  .grid{grid-template-columns:1fr}
  .social-bar{right:8px; top:auto; bottom:16px}
}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">CA</div>
        <div>
          <h1 style="margin:0">CorAlma</h1>
          <div style="font-size:12px;color:#bfeffd">Encuentra tu calma en el universo interior</div>
        </div>
      </div>
      <nav>
        <a href="#medit-block">Meditaci√≥n</a>
        <a href="#tarot-block">Tarot</a>
        <a href="#angels-block">√Ångeles</a>
        <a href="#art">Art√≠culos</a>
      </nav>
    </header>

    <section class="hero card" aria-labelledby="hero-title" style="margin-top:14px">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div>
          <h2 id="hero-title" style="margin:0 0 6px 0">Calma y presencia ‚Äî pr√°cticas basadas en ciencia y tradici√≥n</h2>
          <p style="margin:0;color:#cfeffb">Sonidos, meditaciones, or√°culos y art√≠culos. Haz clic en un mazo para sacar una carta; se mostrar√° un breve significado (usamos texto local y enlace a Wikipedia cuando existe).</p>
        </div>
        <div>
          <button class="btn-primary" onclick="document.getElementById('medit-block').scrollIntoView({behavior:'smooth'})">Iniciar Meditaci√≥n</button>
        </div>
      </div>
    </section>

    <div class="grid">
      <main>
        <!-- Meditaci√≥n -->
        <section id="medit-block" class="card med-card" aria-labelledby="medit-title">
          <h3 id="medit-title">Meditaci√≥n interactiva</h3>
          <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:8px">
            <div class="selector-row">
              <button class="btn-primary" onclick="setTimer(300)">5 min</button>
              <button class="btn-primary" onclick="setTimer(600)">10 min</button>
              <button class="btn-primary" onclick="setTimer(900)">15 min</button>
            </div>
          </div>

          <div style="margin-top:14px" class="center">
            <div id="medCircle" class="deck" role="button" tabindex="0" style="width:140px;height:140px;border-radius:50%">Tocar</div>
            <div id="timeDisplay" class="time-small" style="margin-top:10px;font-weight:800">00:00</div>
            <div class="hint">Temporizador sincronizado con el bot√≥n flotante.</div>
          </div>
        </section>

        <!-- Tarot -->
        <section id="tarot-block" class="card" style="margin-top:16px">
          <h3 style="margin-top:0">Tarot ‚Äî toca solo el mazo</h3>
          <div style="display:flex;gap:20px;align-items:flex-start">
            <div>
              <div id="tarotDeck" class="deck" title="Toca para sacar una carta" aria-label="Mazo Tarot">Mazo Tarot<div class="glow-frame" aria-hidden="true"></div></div>
              <div id="tarotHint" class="hint" style="margin-top:8px">Mostrar√© resumen breve y enlace a Wikipedia (si existe).</div>
            </div>

            <div>
              <div id="tarotReveal" class="reveal" style="display:none" aria-live="polite">
                <div class="card-reveal">
                  <div id="tarotInvertBadge" class="inverted-badge" style="display:none">Invertida</div>
                  <img id="tarotImg" src="" alt="Carta tarot" style="display:block;border-radius:10px;max-height:260px;object-fit:cover" />
                  <div id="tarotName" class="card-title">Nombre carta</div>
                  <div id="tarotText" class="card-desc">Significado breve...</div>
                  <div style="margin-top:8px;text-align:center"><a id="tarotLink" href="#" target="_blank" style="color:#bfeffd;font-size:13px;text-decoration:underline">Leer referencia</a></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Angeles -->
        <section id="angels-block" class="card" style="margin-top:16px">
          <h3 style="margin-top:0">Or√°culo ‚Äî √Ångeles</h3>
          <div style="display:flex;gap:20px;align-items:flex-start">
            <div>
              <div id="angelsDeck" class="deck" title="Toca para recibir un mensaje angelical" aria-label="Mazo √Ångeles">Mazo √Ångeles<div class="glow-frame" aria-hidden="true"></div></div>
              <div class="hint" style="margin-top:8px">Cartas angelicales con mensaje y referencia cuando exista.</div>
            </div>
            <div>
              <div id="angelReveal" class="reveal" style="display:none" aria-live="polite">
                <div class="card-reveal">
                  <img id="angelImg" src="" alt="√Ångel" style="display:block;border-radius:10px;max-height:260px;object-fit:cover" />
                  <div id="angelName" class="card-title">√Ångel</div>
                  <div id="angelText" class="card-desc">Mensaje...</div>
                  <div style="margin-top:8px;text-align:center"><a id="angelLink" href="#" target="_blank" style="color:#bfeffd;font-size:13px;text-decoration:underline">Ver fuente</a></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Playlists -->
        <section class="card" style="margin-top:16px">
          <h3 style="margin-top:0">Playlists (YouTube)</h3>
          <div id="playlistRow" class="playlist-row" aria-live="polite"></div>
          <div class="hint">Miniaturas generadas localmente (click abre playlist en YouTube).</div>
        </section>

        <!-- Art√≠culos -->
        <section id="art" class="card" style="margin-top:16px">
          <h3 style="margin-top:0">Art√≠culos / Referencias</h3>
          <div id="articlesList" class="articles-grid">
            <div class="article-item">Cargando art√≠culos...</div>
          </div>
          <div class="hint">Los 5 primeros art√≠culos incluyen enlace de referencia (Wikipedia).</div>
        </section>
      </main>

      <aside>
        <div class="side-block">
          <div class="card">
            <h4 style="margin-top:0">Frases diarias</h4>
            <div id="fraseBox" style="font-size:15px;background:rgba(255,255,255,0.02);padding:12px;border-radius:8px">Cargando...</div>
            <div class="hint">Una frase para el d√≠a (rotaci√≥n entre 30 frases).</div>
          </div>

          <div class="card" id="reg" style="margin-top:12px">
            <h4 style="margin-top:0">Registro / Frase mensual</h4>
            <form id="subForm">
              <input id="emailInput" type="email" placeholder="tu@correo.com" required style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#dff8ff">
              <div style="margin-top:10px"><button class="btn-primary" type="submit">Suscribirme</button></div>
            </form>
            <div id="subInfo" style="margin-top:12px;color:#bfeffd"></div>
          </div>

          <div class="card" id="don" style="margin-top:12px">
            <h4 style="margin-top:0">Donaciones</h4>
            <p style="margin:0 0 10px 0;color:#cfeef7">Si valoras este proyecto, ap√≥yalo.</p>
            <a class="btn-primary" id="paypalBtn" href="https://www.paypal.com/donate/?hosted_button_id=GW4XCFHYRTJQQ" target="_blank" rel="noopener">Donar con PayPal</a>
          </div>
        </div>
      </aside>
    </div>

    <footer id="contact" style="margin-top:20px">
      <div style="color:#9fd8ea">Contacto: <a href="mailto:almacoralma@gmail.com">almacoralma@gmail.com</a></div>
    </footer>
  </div>

  <!-- floating synchronized timer -->
  <div id="floatingBtn" class="floating-btn" title="Arr√°strame" role="button" aria-label="Temporizador">
    <div id="floatingLabel" class="floating-label">Meditaci√≥n</div>
    <div id="floatingTime" class="floating-time">00:00</div>
  </div>

  <!-- social bar right (usar exactamente los enlaces que diste) -->
  <div class="social-bar" aria-hidden="false">
    <a class="social-btn" href="https://www.instagram.com/effectno33?igsh=MjAycWE4dTFsbXpw" target="_blank" rel="noopener" title="Instagram" aria-label="Instagram">
      <!-- Instagram SVG -->
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 6.1a4.9 4.9 0 1 0 .001 9.8A4.9 4.9 0 0 0 12 8.1zM18.4 5.6a1.1 1.1 0 1 0 0 2.2 1.1 1.1 0 0 0 0-2.2z" fill="#fff"/></svg>
    </a>
    <a class="social-btn" href="https://www.tiktok.com/@effect.33?_t=ZS-8zoEWdno7UL&_r=1" target="_blank" rel="noopener" title="TikTok" aria-label="TikTok">
      <!-- TikTok SVG simplified -->
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 3v10.5A4.5 4.5 0 1 0 13.5 18V7h3V3h-7z" fill="#fff"/></svg>
    </a>
    <a class="social-btn" href="https://youtube.com/@effect.no33?si=1etVu0OT8KashHWN" target="_blank" rel="noopener" title="YouTube" aria-label="YouTube">
      <!-- YouTube SVG -->
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M10 15l5.2-3L10 9v6zM21 8s-.2-1.4-.8-2a3.2 3.2 0 0 0-2.2-.9C15.6 5 12 5 12 5s-3.6 0-5.9.1c-.8 0-1.6.3-2.2.9A4 4 0 0 0 3 8c-.6.6-.8 2-.8 2S2 9.8 2 11.6v.8C2 14.2 2.2 15 2.2 15s.2 1.4.8 2a3.2 3.2 0 0 0 2.2.9C8.4 19 12 19 12 19s3.6 0 5.9-.1c.8 0 1.6-.3 2.2-.9.6-.6.8-2 .8-2s.2-.8.2-2.6v-.8C22 9.8 21.8 9 21.8 9s-.2-1.4-.8-2z" fill="#fff"/></svg>
    </a>
    <a class="social-btn" href="https://www.paypal.com/donate/?hosted_button_id=GW4XCFHYRTJQQ" target="_blank" rel="noopener" title="PayPal" aria-label="PayPal">
      <div class="paypal-p">P</div>
    </a>
  </div>

<script>
/* ----------------- Helpers ----------------- */
const $ = id => document.getElementById(id);

/* ---------- Floating timer & sync (page + floating) ---------- */
let timerSec = 300;            // seconds left
let timerInterval = null;

function pad(n){ return String(n).padStart(2,'0'); }

function updateDisplays(){
  const m = Math.floor(timerSec/60), s = timerSec%60;
  const text = `${pad(m)}:${pad(s)}`;
  const tdisp = $('timeDisplay');
  if(tdisp) tdisp.textContent = text;
  $('floatingTime').textContent = text;
  if(timerSec <= 0){
    $('floatingBtn').classList.add('finished');
    // medCircle text
    const mcur = $('medCircle');
    if(mcur) mcur.textContent = 'Listo';
  } else {
    $('floatingBtn').classList.remove('finished');
    const mcur = $('medCircle');
    if(mcur) mcur.textContent = 'Tocar';
  }
}

function setTimer(sec){
  timerSec = sec;
  updateDisplays();
}

function startTimer(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    if(timerSec > 0){
      timerSec--;
      updateDisplays();
    } else {
      clearInterval(timerInterval);
      timerInterval = null;
      updateDisplays();
      try { new Audio('https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg').play().catch(()=>{}); } catch(e){}
    }
  }, 1000);
}

function stopTimer(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = null;
  updateDisplays();
}

/* UI bindings */
$('medCircle').addEventListener('click', ()=> {
  if(timerInterval) stopTimer();
  else startTimer();
});
$('floatingBtn').addEventListener('click', ()=> {
  if(timerInterval) stopTimer();
  else startTimer();
});

/* ---------- Drag for floating ---------- */
let isDragging=false, offsetX=0, offsetY=0;
const floating = $('floatingBtn');
floating.addEventListener('mousedown', e => {
  isDragging = true;
  offsetX = e.clientX - floating.offsetLeft;
  offsetY = e.clientY - floating.offsetTop;
  e.preventDefault();
});
document.addEventListener('mousemove', e => {
  if(!isDragging) return;
  floating.style.left = (e.clientX - offsetX) + 'px';
  floating.style.top = (e.clientY - offsetY) + 'px';
});
document.addEventListener('mouseup', () => { isDragging=false; });
/* touch */
floating.addEventListener('touchstart', e => {
  isDragging = true;
  const t = e.touches[0];
  offsetX = t.clientX - floating.offsetLeft;
  offsetY = t.clientY - floating.offsetTop;
});
document.addEventListener('touchmove', e => {
  if(!isDragging) return;
  const t = e.touches[0];
  floating.style.left = (t.clientX - offsetX) + 'px';
  floating.style.top = (t.clientY - offsetY) + 'px';
});
document.addEventListener('touchend', ()=> isDragging=false);

updateDisplays();

/* ----------------- Frases diarias (30) ----------------- */
const PHRASES = [
  "Respira profundo; todo est√° bien ahora.",
  "Deja que el silencio te muestre lo esencial.",
  "Hoy es un paso m√°s en tu camino.",
  "La calma se construye con peque√±as pausas.",
  "Siente el presente sin juzgarlo.",
  "Conf√≠a en tu ritmo interior.",
  "Una sonrisa cambia la vibraci√≥n del d√≠a.",
  "Su√©ltalo; no necesitas sostenerlo todo.",
  "Eres suficiente tal como eres.",
  "Escucha lo que tu cuerpo susurra.",
  "Perm√≠tete descansar sin culpa.",
  "La gratitud hace crecer lo que aprecias.",
  "Un pensamiento amable hacia ti, ahora.",
  "Cada inhalaci√≥n trae claridad.",
  "Cultiva paciencia; todo tiene su tiempo.",
  "Abraza la incertidumbre con curiosidad.",
  "Tu coraz√≥n sabe m√°s de lo que imagina la mente.",
  "Peque√±os actos de cuidado, gran efecto.",
  "La naturaleza te recuerda tu origen.",
  "Hoy elige lo que nutre tu paz.",
  "Acepta lo que no puedes cambiar, transforma lo que s√≠.",
  "Observa sin reaccionar.",
  "Tu respiraci√≥n es un ancla siempre disponible.",
  "Permite que la compasi√≥n te gu√≠e.",
  "Regala silencio a tu mente.",
  "Siente tus pies en el suelo; est√°s aqu√≠.",
  "Nadie espera que seas perfecto.",
  "Renueva tu energ√≠a con un gesto amable.",
  "Tu pausa de hoy es tu impulso de ma√±ana.",
  "La serenidad se construye instante a instante."
];
(function showDailyPhrase(){
  const idx = (new Date().getDate() + new Date().getMonth()) % PHRASES.length;
  $('fraseBox').textContent = PHRASES[idx];
})();

/* ----------------- Articles: fetch 5 wiki topics (ES first) ----------------- */
const ARTICLE_TOPICS = ['Meditaci√≥n','Mindfulness','Neurociencia','Relajaci√≥n','Gratitud'];
async function loadArticles(){
  try{
    const container = $('articlesList');
    container.innerHTML = '';
    for(const t of ARTICLE_TOPICS.slice(0,5)){
      let title = t;
      // search Spanish wiki first
      const searchUrl = `https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(t)}&format=json&origin=*`;
      const r = await fetch(searchUrl);
      if(r.ok){
        const j = await r.json();
        if(j.query && j.query.search && j.query.search[0]) title = j.query.search[0].title;
      }
      const summaryUrl = `https://es.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
      let s = null;
      try{
        const rr = await fetch(summaryUrl);
        if(rr.ok) s = await rr.json();
      }catch(e){}
      const item = document.createElement('div');
      item.className = 'article-item';
      const summaryText = s && s.extract ? s.extract.slice(0,260) + (s.extract.length>260?'...':'') : 'Resumen no disponible.';
      const href = s && s.content_urls && s.content_urls.desktop ? s.content_urls.desktop.page : ('https://es.wikipedia.org/w/index.php?search=' + encodeURIComponent(title));
      item.innerHTML = `<h4>${s && s.title ? s.title : title}</h4><p>${summaryText}</p><div style="margin-top:8px"><a href="${href}" target="_blank" style="color:#bfeffd;text-decoration:underline">Leer referencia</a></div>`;
      container.appendChild(item);
    }
  }catch(e){
    $('articlesList').innerHTML = '<div class="article-item">No fue posible cargar art√≠culos.</div>';
  }
}
loadArticles();

/* ----------------- Tarot deck generation (names & meanings) ----------------- */
/* Major Arcana (Spanish names) */
const MAJOR_ARCANA = [
  "El Loco","El Mago","La Sacerdotisa","La Emperatriz","El Emperador",
  "El Sumo Sacerdote","Los Enamorados","El Carro","La Fuerza","El Ermita√±o",
  "La Rueda de la Fortuna","La Justicia","El Colgado","La Muerte","La Templanza",
  "El Diablo","La Torre","La Estrella","La Luna","El Sol",
  "El Juicio","El Mundo"
];

const SUITS = ["Copas","Oros","Espadas","Bastos"];
const RANKS = ["As","Dos","Tres","Cuatro","Cinco","Seis","Siete","Ocho","Nueve","Diez","Sota","Caballero","Reina","Rey"];

function buildFullDeck(){
  const deck = [...MAJOR_ARCANA];
  for(const suit of SUITS){
    for(const r of RANKS){
      deck.push(`${r} de ${suit}`);
    }
  }
  return deck;
}
const FULL_DECK = buildFullDeck();

/* Local concise meanings for majors (paraphrased) */
const CARD_MEANINGS = {
  "El Loco":"Nuevos comienzos, espontaneidad y fe. Invertido: imprudencia o falta de rumbo.",
  "El Mago":"Voluntad, habilidades y manifestaci√≥n. Invertido: dispersi√≥n o manipulaci√≥n.",
  "La Sacerdotisa":"Intuici√≥n, misterio, sabidur√≠a interior.",
  "La Emperatriz":"Fertilidad, creatividad, abundancia.",
  "El Emperador":"Orden, estructura, autoridad.",
  "El Sumo Sacerdote":"Tradici√≥n, gu√≠a espiritual, ense√±anza.",
  "Los Enamorados":"Elecciones del coraz√≥n, relaciones, uni√≥n.",
  "El Carro":"Voluntad y triunfo sobre obst√°culos.",
  "La Fuerza":"Coraje, dominio interior y compasi√≥n.",
  "El Ermita√±o":"Reflexi√≥n, b√∫squeda interior y retiro.",
  "La Rueda de la Fortuna":"Ciclos, cambios y destino.",
  "La Justicia":"Equilibrio, responsabilidad y verdad.",
  "El Colgado":"Entrega, pausa y cambio de perspectiva.",
  "La Muerte":"Transformaci√≥n y cierre necesario.",
  "La Templanza":"Equilibrio, moderaci√≥n y armon√≠a.",
  "El Diablo":"Ligaduras, sombra y ataduras a superar.",
  "La Torre":"Ca√≠da de estructuras, despertar brusco.",
  "La Estrella":"Esperanza, renovaci√≥n y gu√≠a.",
  "La Luna":"Inconsciente, sue√±os y ambig√ºedad.",
  "El Sol":"√âxito, claridad y vitalidad.",
  "El Juicio":"Renacimiento, llamado y evaluaci√≥n.",
  "El Mundo":"Culminaci√≥n, realizaci√≥n e integraci√≥n."
};

/* Generic minors via helper */
function minorMeaning(rank, suit){
  const suitKeywords = {
    "Copas": "emociones y relaciones",
    "Oros": "lo material y la seguridad",
    "Espadas": "la mente y los conflictos",
    "Bastos": "acci√≥n y creatividad"
  };
  const rnum = {"As":"nuevo inicio","Dos":"asociaci√≥n","Tres":"crecimiento","Cuatro":"estabilidad","Cinco":"conflicto","Seis":"transici√≥n","Siete":"defensa","Ocho":"rapidez","Nueve":"preocupaci√≥n","Diez":"culminaci√≥n","Sota":"mensaje","Caballero":"movimiento","Reina":"madurez","Rey":"dominio"};
  const base = rnum[rank] || rank.toLowerCase();
  return `${base} en el √°rea de ${suitKeywords[suit] || suit}.`;
}

/* ----------------- Wikipedia helper ----------------- */
async function wikiSummaryFor(query){
  // try Spanish first
  try{
    const sUrl = `https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;
    let res = await fetch(sUrl);
    if(res.ok){
      let j = await res.json();
      if(j.query && j.query.search && j.query.search.length){
        const title = j.query.search[0].title;
        const summaryUrl = `https://es.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
        const rr = await fetch(summaryUrl);
        if(rr.ok){
          const summary = await rr.json();
          return summary;
        }
      }
    }
  }catch(e){}
  // fallback english
  try{
    const sUrl = `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;
    let res = await fetch(sUrl);
    if(res.ok){
      let j = await res.json();
      if(j.query && j.query.search && j.query.search.length){
        const title = j.query.search[0].title;
        const summaryUrl = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
        const rr = await fetch(summaryUrl);
        if(rr.ok){
          const summary = await rr.json();
          return summary;
        }
      }
    }
  }catch(e){}
  return null;
}

/* Canvas-based card image generator (returns dataURL) */
function generateCardImage(name, subtitle = '', type = 'tarot', opts = {}) {
  const w = opts.width || 900;
  const h = opts.height || 1200;
  const canvas = document.createElement('canvas');
  canvas.width = w; canvas.height = h;
  const ctx = canvas.getContext('2d');

  // background gradient (aurora feel)
  const grad = ctx.createLinearGradient(0,0,w,h);
  grad.addColorStop(0, '#0f0c29');
  grad.addColorStop(0.4, '#302b63');
  grad.addColorStop(1, '#24243e');
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,w,h);

  // radial glow
  const rg = ctx.createRadialGradient(w*0.7, h*0.2, 50, w*0.7, h*0.2, h);
  rg.addColorStop(0, 'rgba(138,108,255,0.12)');
  rg.addColorStop(0.6, 'rgba(110,198,217,0.06)');
  rg.addColorStop(1, 'rgba(0,0,0,0)');
  ctx.fillStyle = rg;
  ctx.fillRect(0,0,w,h);

  // inner card rect
  const pad = Math.round(w*0.06);
  const rx = pad, ry = pad, rw = w - pad*2, rh = h - pad*2;
  // inner background
  ctx.fillStyle = 'rgba(255,255,255,0.02)';
  roundRect(ctx, rx, ry, rw, rh, 36, true, false);

  // decorative frame
  drawFrame(ctx, rx, ry, rw, rh);

  // symbol area
  const symY = ry + Math.round(rh*0.08);
  const symH = Math.round(rh*0.56);
  drawSymbol(ctx, w/2, symY + symH/2, Math.round(Math.min(w,rh)*0.12), type, opts.symbol);

  // Title
  ctx.fillStyle = '#e6f9ff';
  ctx.textAlign = 'center';
  ctx.font = `700 ${Math.round(w*0.04)}px Inter, system-ui, sans-serif`;
  wrapText(ctx, name, w/2, symY + symH + Math.round(w*0.04) + 6, Math.round(w*0.8), Math.round(w*0.05));

  // Subtitle
  if(subtitle){
    ctx.fillStyle = 'rgba(223,248,255,0.9)';
    ctx.font = `${Math.round(w*0.026)}px Inter, system-ui, sans-serif`;
    wrapText(ctx, subtitle, w/2, symY + symH + Math.round(w*0.04) + 48, Math.round(w*0.76), Math.round(w*0.038));
  }

  // footer credit
  ctx.fillStyle = 'rgba(191,239,253,0.8)';
  ctx.font = `${Math.round(w*0.022)}px Inter, system-ui, sans-serif`;
  ctx.fillText('CorAlma ‚Äî Or√°culo', w/2, h - pad + 6);

  // inversion
  if(opts.inverted){
    const temp = document.createElement('canvas');
    temp.width = w; temp.height = h;
    const tctx = temp.getContext('2d');
    tctx.translate(w/2, h/2);
    tctx.rotate(Math.PI);
    tctx.translate(-w/2, -h/2);
    tctx.drawImage(canvas, 0, 0);
    return temp.toDataURL('image/png');
  }
  return canvas.toDataURL('image/png');

  // utils
  function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
    if (typeof stroke === 'undefined') stroke = true;
    if (typeof radius === 'undefined') radius = 5;
    if (typeof radius === 'number') {
      radius = {tl: radius, tr: radius, br: radius, bl: radius};
    }
    ctx.beginPath();
    ctx.moveTo(x + radius.tl, y);
    ctx.lineTo(x + width - radius.tr, y);
    ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
    ctx.lineTo(x + width, y + height - radius.br);
    ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
    ctx.lineTo(x + radius.bl, y + height);
    ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
    ctx.lineTo(x, y + radius.tl);
    ctx.quadraticCurveTo(x, y, x + radius.tl, y);
    ctx.closePath();
    if (fill) ctx.fill();
    if (stroke) {
      ctx.lineWidth = Math.max(3, Math.round(width*0.006));
      ctx.strokeStyle = 'rgba(255,255,255,0.06)';
      ctx.stroke();
    }
  }
  function drawFrame(ctx, x, y, w, h){
    ctx.save();
    ctx.lineWidth = Math.max(4, Math.round(w*0.01));
    const grad = ctx.createLinearGradient(x, y, x+w, y+h);
    grad.addColorStop(0, 'rgba(255,220,130,0.95)');
    grad.addColorStop(0.5, 'rgba(255,255,255,0.85)');
    grad.addColorStop(1, 'rgba(255,200,100,0.9)');
    ctx.strokeStyle = grad;
    roundRect(ctx, x-8, y-8, w+16, h+16, 40, false, true);
    ctx.restore();
  }
  function drawSymbol(ctx, cx, cy, radius, type, symbol){
    ctx.save();
    const halo = ctx.createRadialGradient(cx,cy, radius*0.2, cx,cy, radius*1.3);
    halo.addColorStop(0, 'rgba(255,255,255,0.14)');
    halo.addColorStop(1, 'rgba(255,255,255,0)');
    ctx.fillStyle = halo;
    ctx.beginPath();
    ctx.arc(cx, cy, radius*1.25, 0, Math.PI*2);
    ctx.fill();
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = `${Math.round(radius*1.6)}px serif`;
    let sym = symbol || (type === 'angels' ? 'üëº' : '‚òÖ');
    ctx.fillStyle = '#fff';
    ctx.fillText(sym, cx, cy + (type === 'angels' ? -6 : 0));
    ctx.restore();
  }
  function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
    const words = text.split(' ');
    let line = '';
    let lineCount = 0;
    for(let n = 0; n < words.length; n++) {
      const testLine = line + words[n] + ' ';
      if(ctx.measureText(testLine).width > maxWidth && n > 0){
        ctx.fillText(line, x, y + (lineCount * lineHeight));
        line = words[n] + ' ';
        lineCount++;
      } else {
        line = testLine;
      }
    }
    ctx.fillText(line, x, y + (lineCount * lineHeight));
  }
}

/* ----------------- Tarot draw logic ----------------- */
async function drawTarot(){
  const deckEl = $('tarotDeck');
  const revealBox = $('tarotReveal');
  const img = $('tarotImg');
  const nameEl = $('tarotName');
  const textEl = $('tarotText');
  const linkEl = $('tarotLink');
  const invertBadge = $('tarotInvertBadge');

  // UI quick bounce
  deckEl.style.transform='translateY(-6px)';
  setTimeout(()=> deckEl.style.transform='translateY(0)',160);

  // pick random
  const idx = Math.floor(Math.random()*FULL_DECK.length);
  const cardName = FULL_DECK[idx];
  const inverted = Math.random() < 0.45;

  // local meaning (always available)
  let meaning = CARD_MEANINGS[cardName];
  if(!meaning){
    const m = cardName.match(/^(.+?) de (.+)$/);
    if(m) meaning = minorMeaning(m[1], m[2]);
    else meaning = 'Significado general: interpretaci√≥n simb√≥lica seg√∫n contexto.';
  }

  // try wiki for extra (non-blocking)
  let wiki = null;
  try{ wiki = await wikiSummaryFor(cardName + ' tarot') || await wikiSummaryFor(cardName); }catch(e){ wiki=null; }

  // compose displayed text: local meaning first, then wiki short (if any)
  let displayed = meaning;
  if(wiki && wiki.extract){
    displayed += '\n\nReferencia (Wikipedia): ' + (wiki.extract.length > 300 ? wiki.extract.slice(0,300)+'...' : wiki.extract);
  }

  // generate image, include a short subtitle
  const dataUrl = generateCardImage(cardName, meaning.slice(0,160), 'tarot', {inverted: inverted, symbol: '‚òÖ', width: 800, height: 1100});

  img.src = dataUrl;
  img.style.display = 'block';
  nameEl.textContent = cardName + (inverted ? ' (invertida)' : '');
  textEl.textContent = displayed;
  linkEl.href = (wiki && wiki.content_urls && wiki.content_urls.desktop && wiki.content_urls.desktop.page) ? wiki.content_urls.desktop.page : ('https://es.wikipedia.org/w/index.php?search=' + encodeURIComponent(cardName));
  invertBadge.style.display = inverted ? 'block' : 'none';
  revealBox.style.display = 'block';
  revealBox.scrollIntoView({behavior:'smooth', block:'center'});
}
$('tarotDeck').addEventListener('click', drawTarot);

/* ----------------- Angels (bigger set) ----------------- */
const ANGEL_ORACLE = [
  {name:'Arc√°ngel Miguel', msg:'Protecci√≥n, coraje y liberaci√≥n del miedo.'},
  {name:'Arc√°ngel Gabriel', msg:'Comunicaci√≥n clara, mensajes y creatividad.'},
  {name:'Arc√°ngel Rafael', msg:'Sanaci√≥n, cuidado y bienestar f√≠sico.'},
  {name:'Arc√°ngel Uriel', msg:'Iluminaci√≥n, claridad y soluciones pr√°cticas.'},
  {name:'Arc√°ngel Chamuel', msg:'Amor, compasi√≥n y reconciliaci√≥n.'},
  {name:'Arc√°ngel Zadkiel', msg:'Perd√≥n, transformaci√≥n y misericordia.'},
  {name:'Arc√°ngel Jofiel', msg:'Belleza, inspiraci√≥n y perspectiva positiva.'},
  {name:'√Ångel de la Guarda', msg:'Apoyo cotidiano y gu√≠a silenciosa.'},
  {name:'Arc√°ngel Metatr√≥n', msg:'Orden, conexi√≥n y registro ak√°shico.'},
  {name:'Arc√°ngel Raguel', msg:'Armon√≠a en relaciones y justicia.'},
  {name:'Arc√°ngel Haniel', msg:'Intuici√≥n, gracia y encanto.'},
  {name:'Arc√°ngel Jeremiel', msg:'So√±ar con prop√≥sito, revisi√≥n de vida.'},
  {name:'Arc√°ngel Ariel', msg:'Naturaleza, abundancia y coraje.'},
  {name:'Arc√°ngel Selaphiel', msg:'Paz, oraci√≥n y consuelo.'},
  {name:'Arc√°ngel Barachiel', msg:'Bendiciones y gratitud activa.'}
];

async function drawAngel(){
  const deck = $('angelsDeck');
  const reveal = $('angelReveal');
  const img = $('angelImg'), nameEl = $('angelName'), textEl = $('angelText'), linkEl = $('angelLink');

  deck.style.transform='translateY(-6px)';
  setTimeout(()=> deck.style.transform='translateY(0)', 140);

  const idx = Math.floor(Math.random()*ANGEL_ORACLE.length);
  const card = ANGEL_ORACLE[idx];
  nameEl.textContent = card.name;
  textEl.textContent = card.msg;

  // try wiki for image/summary
  let wiki = null;
  try{ wiki = await wikiSummaryFor(card.name); }catch(e){ wiki=null; }
  if(wiki && wiki.thumbnail && wiki.thumbnail.source){
    img.src = wiki.thumbnail.source;
    img.style.display = 'block';
    linkEl.href = (wiki.content_urls && wiki.content_urls.desktop && wiki.content_urls.desktop.page) ? wiki.content_urls.desktop.page : '#';
  } else {
    const dataUrl = generateCardImage(card.name, card.msg, 'angels', {symbol:'üëº', width:800, height:1100});
    img.src = dataUrl;
    img.style.display = 'block';
    linkEl.href = (wiki && wiki.content_urls && wiki.content_urls.desktop && wiki.content_urls.desktop.page) ? wiki.content_urls.desktop.page : '#';
  }
  reveal.style.display = 'block';
  reveal.scrollIntoView({behavior:'smooth', block:'center'});
}
$('angelsDeck').addEventListener('click', drawAngel);

/* ----------------- Playlists: use the URLs you sent & generate thumbnails locally ----------------- */
const PLAYLISTS = [
  {url:'https://youtube.com/playlist?list=PL6FMHId50GbE14ydduaNffH9ZCwpIOKpS', title:'Playlist 1'},
  {url:'https://youtube.com/playlist?list=PL6FMHId50GbE14ydduaNffH9ZCwpIOKpS', title:'Playlist 2'},
  {url:'https://youtube.com/playlist?list=PL6FMHId50GbGGi06g4gMUzsfMNveEKNxQ', title:'Playlist 3'}
];

function makePlaylistThumb(title, w=400, h=225){
  const c = document.createElement('canvas');
  c.width = w; c.height = h;
  const ctx = c.getContext('2d');
  // bg gradient
  const g = ctx.createLinearGradient(0,0,w,h);
  g.addColorStop(0,'#0f1724'); g.addColorStop(1,'#1f3146');
  ctx.fillStyle = g; ctx.fillRect(0,0,w,h);
  // subtle aurora streak
  const rg = ctx.createLinearGradient(0,0,w,0);
  rg.addColorStop(0,'rgba(110,198,217,0.12)'); rg.addColorStop(0.5,'rgba(138,108,255,0.12)'); rg.addColorStop(1,'rgba(255,182,150,0.06)');
  ctx.fillStyle = rg; ctx.fillRect(0,h*0.05,w,h*0.25);
  // big red play triangle
  ctx.fillStyle = '#ff0000';
  const px = w*0.12, py = h*0.5;
  ctx.beginPath();
  ctx.moveTo(px, py - 32);
  ctx.lineTo(px, py + 32);
  ctx.lineTo(px + 56, py);
  ctx.closePath();
  ctx.fill();
  // title
  ctx.fillStyle = '#eaf9ff'; ctx.font = 'bold 16px Inter, sans-serif';
  wrapTextSmall(ctx, title, w*0.6, h*0.45, w*0.55, 18);
  // small label bottom
  ctx.fillStyle = 'rgba(191,239,253,0.7)'; ctx.font = '12px Inter, sans-serif';
  ctx.fillText('YouTube ‚Ä¢ Playlist', w*0.6, h*0.85);
  return c.toDataURL('image/png');
}
function wrapTextSmall(ctx, text, x, y, maxWidth, lineHeight) {
  const words = text.split(' ');
  let line = '', lineCount = 0;
  ctx.textAlign = 'left';
  for(let n=0;n<words.length;n++){
    const testLine = line + words[n] + ' ';
    if(ctx.measureText(testLine).width > maxWidth && n>0){
      ctx.fillText(line.trim(), x, y + (lineCount*lineHeight));
      line = words[n] + ' ';
      lineCount++;
    } else line = testLine;
  }
  ctx.fillText(line.trim(), x, y + (lineCount*lineHeight));
}

function renderPlaylists(){
  const row = $('playlistRow');
  row.innerHTML = '';
  PLAYLISTS.forEach((p, i)=>{
    const div = document.createElement('div'); div.className='pl-card';
    const img = document.createElement('img');
    img.src = makePlaylistThumb(p.title || `Playlist ${i+1}`, 400, 225);
    img.alt = p.title || `Playlist ${i+1}`;
    img.style.cursor = 'pointer';
    img.addEventListener('click', ()=> window.open(p.url,'_blank'));
    const a = document.createElement('a'); a.className='pl-title'; a.href=p.url; a.target='_blank'; a.textContent = p.title || `Playlist ${i+1}`;
    div.appendChild(img); div.appendChild(a);
    row.appendChild(div);
  });
}
renderPlaylists();

/* ----------------- Subscription form ----------------- */
$('subForm').addEventListener('submit', e=>{
  e.preventDefault();
  $('subInfo').textContent = '¬°Gracias! Te hemos suscrito (demo)';
  $('emailInput').value = '';
});

/* Prevent selection while dragging */
document.addEventListener('touchmove', function(e){ if(isDragging) e.preventDefault(); }, {passive:false});
</script>
</body>
</html>