<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CorAlma — Encuentra tu calma</title>
<meta name="description" content="Meditaciones, sonidos, tarot interactivo, frases diarias, playlists y artículos." />
<style>
:root{
  --bg1:#020414; --bg2:#041428;
  --accent1:#6ec6d9; --accent2:#8a6cff;
  --glass: rgba(255,255,255,0.04);
  --muted:#9fd8ea; --text:#e6f9ff;
  --finished:#ff6b6b;
  --card-bg: rgba(255,255,255,0.02);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; -webkit-font-smoothing:antialiased}
body{
  color:var(--text);
  background:
    radial-gradient(circle at 10% 10%, rgba(138,108,255,0.06), transparent 6%),
    radial-gradient(circle at 90% 70%, rgba(110,198,217,0.04), transparent 10%),
    linear-gradient(180deg,var(--bg1), var(--bg2));
  min-height:100vh;
  overflow-x:hidden;
  position:relative;
}

/* Particle canvas behind everything */
#particleCanvas{position:fixed;left:0;top:0;width:100%;height:100%;z-index:0;pointer-events:none;opacity:0.12}

/* container */
.container{max-width:1180px;margin:24px auto;padding:18px;position:relative;z-index:1}
header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;font-weight:700;color:#021018}
nav{display:flex;gap:10px;align-items:center}
nav a{color:#cfeffb;text-decoration:none;padding:8px 10px;border-radius:9px}
nav a:hover{background:var(--glass)}

/* hero */
.hero{margin-top:14px;border-radius:14px;padding:20px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));display:flex;gap:20px;align-items:center;position:relative;overflow:hidden}
.hero-left{flex:1}
.cta .btn-primary{margin-top:12px}

/* layout */
.grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-top:22px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:16px;border-radius:12px}
.med-card{padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);box-shadow:0 10px 40px rgba(15,30,50,0.45)}
.center{display:flex;flex-direction:column;align-items:center;gap:12px}
select,input,button{background:transparent;color:#dff8ff;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)}
.btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#021018;padding:8px 12px;border-radius:10px;border:0;font-weight:700;cursor:pointer}

/* meditación */
.selector-row{display:flex;gap:10px;align-items:center;width:100%;justify-content:center;flex-wrap:wrap}
.med-circle{width:160px;height:160px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent2),var(--accent1));color:#021018;font-weight:700;font-size:16px;cursor:pointer;box-shadow:0 12px 40px rgba(60,80,120,0.18);transition:transform .12s,border-color .2s}
.med-circle:hover{transform:scale(1.03)}
.time-display{font-weight:700}

/* articles */
.articles-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px;max-height:320px;overflow:auto;padding-right:6px}
.article-card{padding:12px;border-radius:10px;background:rgba(255,255,255,0.01);text-align:left}
.article-card h3{margin:0 0 6px 0;font-size:16px}
.article-card p{margin:0;color:#cfeef7;font-size:14px}
.article-card .source{font-size:12px;color:#9fd8ea;margin-top:6px}
.read-btn{margin-top:8px;padding:6px 8px;border-radius:8px;border:0;background:rgba(255,255,255,0.04);color:#dff8ff;cursor:pointer}

/* youtube */
.youtube-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-top:12px}
.youtube-thumb{background:#0b1620;border-radius:8px;overflow:hidden;cursor:pointer;position:relative}
.youtube-thumb img{width:100%;display:block;height:88px;object-fit:cover}
.youtube-thumb .yt-title{font-size:12px;padding:6px;color:#eaf9ff}
.youtube-controls{display:flex;gap:6px;justify-content:center;padding-top:6px}

/* tarot */
#tarotSection{display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap}
#mazo{width:180px;height:260px;border-radius:10px;background-image:linear-gradient(180deg,#2a1f44,#1b2633);display:flex;align-items:center;justify-content:center;box-shadow:0 12px 40px rgba(0,0,0,0.5);cursor:pointer;border:4px solid rgba(255,255,255,0.03);position:relative}
#mazo:hover{transform:translateY(-4px);transition:transform .18s}
#cardWrap{min-width:240px;min-height:340px;display:flex;align-items:center;justify-content:center;position:relative}
#cardReveal{width:240px;height:340px;border-radius:10px;object-fit:cover;box-shadow:0 18px 50px rgba(0,0,0,0.6);display:none;backface-visibility:hidden;transform-style:preserve-3d;transition:transform .9s cubic-bezier(.2,.8,.2,1), opacity .6s}
.card-inverted{transform: rotate(180deg) scale(1);}

/* glow animations for energy — fade-in then pulse forever */
@keyframes glowPulse {
  0% { box-shadow: 0 0 10px rgba(0,0,0,0); transform: scale(1); }
  10% { box-shadow: 0 0 14px rgba(0,0,0,0); transform: scale(1.01); }
  50% { box-shadow: 0 0 28px var(--glowColor); transform: scale(1.02); }
  100% { box-shadow: 0 0 18px rgba(0,0,0,0); transform: scale(1); }
}
.glow-green{ --glowColor: rgba(98, 255, 150, 0.9); animation: glowPulse 2.6s ease-in-out infinite; }
.glow-yellow{ --glowColor: rgba(255, 222, 100, 0.95); animation: glowPulse 2.6s ease-in-out infinite; }
.glow-red{ --glowColor: rgba(255,90,90,0.95); animation: glowPulse 2.6s ease-in-out infinite; }

/* initial fade-in for glow */
.glow-fade-in { animation-name: glowPulse; animation-duration: 2.6s; animation-fill-mode: both; }

/* history thumbs */
#history{display:flex;gap:8px;align-items:center;margin-top:10px}
.hist-thumb{width:48px;height:70px;border-radius:6px;overflow:hidden;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
.hist-thumb img{width:100%;height:100%;object-fit:cover}

/* deck grid (optional) */
#deckGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(60px,1fr));gap:6px;padding:8px;background:rgba(0,0,0,0.12);border-radius:8px;max-height:300px;overflow:auto;margin-top:12px;display:none}
.card-mini{width:100%;height:84px;border-radius:6px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
.card-mini img{width:100%;height:100%;object-fit:cover;display:block}

/* phrase box */
.phrase-box{background:var(--card-bg);padding:14px;border-radius:10px;color:#dff8ff;font-size:15px;min-height:72px;display:flex;align-items:center;justify-content:center;text-align:center;transition:opacity .6s}

/* playlists layout */
.playlists{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:12px}
.playlists iframe{width:100%;height:200px;border-radius:8px;border:0;}

/* social bar (exact as requested — right side with icons + PayPal) */
.social-bar {
  position: fixed;
  top: 45%;
  right: 0;
  transform: translateY(-50%);
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:8px;
  background:rgba(0,0,0,0.18);
  border-radius:12px 0 0 12px;
  z-index:1200;
}
.social-bar a{display:flex;align-items:center;justify-content:center;width:44px;height:44px;background:transparent;border-radius:8px;color:#fff;text-decoration:none}
.social-bar a:hover{background:rgba(255,255,255,0.04)}
.social-bar .pay{background:linear-gradient(90deg,#ffd100,#2d9cff);border-radius:10px;padding:8px}

/* floating timer */
.floating-btn{position:fixed;right:20px;bottom:20px;width:120px;height:120px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent2),var(--accent1));color:#021018;font-weight:700;cursor:move;z-index:2000;box-shadow:0 12px 40px rgba(60,80,120,0.18);transition:background .25s}
.floating-btn.finished{background:var(--finished); color:#fff;}

/* responsive tweaks */
@media(max-width:980px){
  .grid{grid-template-columns:1fr}
  .articles-grid{grid-template-columns:1fr}
  #cardReveal{width:180px;height:260px}
  #mazo{width:140px;height:200px}
  #tarotSection{flex-direction:column;align-items:center}
  .social-bar{top:auto;bottom:10px;right:50%;transform:translateX(50%);flex-direction:row;border-radius:12px}
}
</style>
</head>
<body>
  <!-- particle background canvas -->
  <canvas id="particleCanvas"></canvas>

  <!-- social bar (DO NOT change links; kept as requested) -->
  <div class="social-bar" aria-hidden="false">
    <a href="https://www.instagram.com/effectno33?igsh=MjAycWE4dTFsbXpw" target="_blank" title="Instagram"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram" style="width:24px;height:24px"></a>
    <a href="https://www.tiktok.com/@effect.33?_t=ZS-8zoEWdno7UL&_r=1" target="_blank" title="TikTok"><img src="https://cdn-icons-png.flaticon.com/512/3046/3046121.png" alt="TikTok" style="width:24px;height:24px"></a>
    <a href="https://youtube.com/@effect.no33?si=1etVu0OT8KashHWN" target="_blank" title="YouTube"><img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YouTube" style="width:24px;height:24px"></a>
    <a class="pay" href="https://www.paypal.com/donate/?hosted_button_id=GW4XCFHYRTJQQ" target="_blank" title="Donar con PayPal"><img src="https://www.paypalobjects.com/es_XC/i/btn/btn_donateCC_LG.gif" alt="PayPal" style="height:28px"></a>
  </div>

  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">CA</div>
        <div>
          <h1>CorAlma</h1>
          <div style="font-size:12px;color:#bfeffd">Encuentra tu calma en el universo interior</div>
        </div>
      </div>
      <nav>
        <a href="#">Inicio</a>
        <a href="#medit-block">Meditación</a>
        <a href="#art">Artículos</a>
        <a href="#tarot">Tarot</a>
        <a href="#music">Música</a>
        <a href="#contact">Contacto</a>
      </nav>
    </header>

    <section class="hero card med-card" aria-labelledby="hero-title">
      <div class="hero-left">
        <h2 id="hero-title">Calma y presencia — prácticas basadas en ciencia y tradición</h2>
        <p>Meditaciones, tarot interactivo con interpretaciones desde Wikipedia, playlists y artículos con referencias.</p>
        <div class="cta"><button class="btn-primary" onclick="document.getElementById('medit-block').scrollIntoView({behavior:'smooth'})">Iniciar Meditación</button></div>
      </div>
    </section>

    <div class="grid">
      <main>
        <!-- Meditación -->
        <section id="medit-block" class="card med-card" aria-labelledby="medit-title">
          <h3 id="medit-title">Meditación interactiva</h3>
          <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
            <!-- removed sound selector per your request -->
            <div class="selector-row" style="gap:8px">
              <button class="btn-primary" onclick="setTimer(300)">5 min</button>
              <button class="btn-primary" onclick="setTimer(600)">10 min</button>
              <button class="btn-primary" onclick="setTimer(900)">15 min</button>
            </div>
          </div>

          <div style="margin-top:14px" class="center">
            <div id="medCircle" class="med-circle" role="button" tabindex="0">Click para<br>meditar</div>
            <div class="time-display" style="margin-top:10px">Tiempo: <span id="timeDisplay">00:00</span></div>
          </div>

          <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
            <button id="startBtn" class="btn-primary">Iniciar</button>
            <button id="stopBtn" class="btn-primary" style="background:transparent;border:1px solid rgba(255,255,255,0.06)">Detener</button>
            <label style="margin-left:8px;font-size:13px"><input id="audioOnlyToggle" type="checkbox"> Solo audio</label>
          </div>

          <div id="audioNotice" class="notice" style="display:none"></div>
          <audio id="natureAudio" preload="none" controls style="display:none"></audio>
        </section>

        <!-- Artículos (solo 5 con link) -->
        <section class="card" style="margin-top:16px" id="art">
          <h3 style="margin-top:0">Artículos</h3>
          <div class="articles-grid" id="articlesGrid" role="list"></div>
        </section>

        <!-- Tarot -->
        <section id="tarot" class="card" style="margin-top:16px">
          <h3>Tarot — Toca el mazo</h3>
          <div id="tarotSection">
            <div style="display:flex;flex-direction:column;gap:10px;align-items:center">
              <div id="mazo" title="Toca el mazo para sacar una carta" aria-label="Mazo de tarot">
                <div style="color:#fff;text-align:center;font-weight:700">MAZO</div>
              </div>
              <button id="toggleDeckBtn" class="btn-primary" style="font-size:13px;padding:6px 8px">Ver mazo completo</button>
            </div>

            <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-start">
              <div id="cardWrap">
                <div id="cardLoader" class="loader" style="display:none"></div>
                <img id="cardReveal" alt="Carta revelada" />
              </div>

              <div id="tarotText" aria-live="polite">Toca el mazo para revelar una carta. Interpretación desde Wikipedia (texto en español cuando esté disponible).</div>

              <div id="history" aria-hidden="false"></div>
            </div>
          </div>

          <!-- Deck grid (hidden by default, full deck clickable) -->
          <div id="deckGrid"></div>
        </section>

        <!-- YouTube playlists -->
        <section id="music" class="card" style="margin-top:16px">
          <h3>Recomendaciones / Playlists (YouTube)</h3>
          <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
            <input id="ytSearchInput" type="text" placeholder="Buscar en YouTube..." style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#dff8ff" list="ytSuggestions">
            <datalist id="ytSuggestions">
              <option value="relajación"></option>
              <option value="meditación guiada"></option>
              <option value="sonidos de la naturaleza"></option>
              <option value="concentración"></option>
              <option value="respiración"></option>
            </datalist>
            <button class="btn-primary" onclick="ytSearch()">Buscar</button>
          </div>
          <div class="playlists">
            <!-- the three playlists you provided -->
            <iframe src="https://www.youtube.com/embed/videoseries?list=PL6FMHId50GbE14ydduaNffH9ZCwpIOKpS" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            <iframe src="https://www.youtube.com/embed/videoseries?list=PL6FMHId50GbE14ydduaNffH9ZCwpIOKpS" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            <iframe src="https://www.youtube.com/embed/videoseries?list=PL6FMHId50GbGGi06g4gMUzsfMNveEKNxQ" allow="autoplay; encrypted-media" allowfullscreen></iframe>
          </div>
        </section>
      </main>

      <aside>
        <div class="card">
          <h4 style="margin-top:0">Frases diarias</h4>
          <div id="phraseBox" class="phrase-box"></div>
        </div>

        <div class="card" id="reg" style="margin-top:12px">
          <h4 style="margin-top:0">Registro / Frase mensual</h4>
          <form id="subForm">
            <input id="emailInput" type="email" placeholder="tu@correo.com" required style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#dff8ff">
            <div style="margin-top:10px"><button class="btn-primary" type="submit">Suscribirme</button></div>
          </form>
          <div id="subInfo" style="margin-top:12px;color:#bfeffd"></div>
        </div>

        <div class="card" id="don" style="margin-top:12px">
          <h4 style="margin-top:0">Donaciones</h4>
          <p style="margin:0 0 10px 0;color:#cfeef7">Si valoras este proyecto, apóyalo.</p>
          <a class="btn-primary" href="https://www.paypal.com/donate/?hosted_button_id=GW4XCFHYRTJQQ" target="_blank" rel="noopener">Donar con PayPal</a>
        </div>
      </aside>
    </div>

    <footer id="contact" style="margin-top:20px">
      <div style="color:#9fd8ea">Contacto: <a href="mailto:almacoralma@gmail.com">almacoralma@gmail.com</a></div>
    </footer>
  </div>

  <!-- floating synchronized timer -->
  <div id="floatingBtn" class="floating-btn" title="Arrástrame">
    <div id="floatingLabel">Meditación</div>
    <div id="floatingTime" style="font-size:13px;margin-top:6px">00:00</div>
  </div>

<script>
/* ----------------- Particle background (light constelation) ----------------- */
(function initParticles(){
  const canvas = document.getElementById('particleCanvas');
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  let w = canvas.width = innerWidth;
  let h = canvas.height = innerHeight;
  window.addEventListener('resize', ()=>{ w = canvas.width = innerWidth; h = canvas.height = innerHeight; init(); });

  const particles = [];
  function rand(min,max){ return Math.random()*(max-min)+min; }
  function init(){
    particles.length = 0;
    const n = Math.max(40, Math.floor((w*h)/140000));
    for(let i=0;i<n;i++){
      particles.push({x:rand(0,w), y:rand(0,h), vx:rand(-0.2,0.2), vy:rand(-0.05,0.05), r:rand(0.3,1.6), a:rand(0.05,0.35)});
    }
  }
  function draw(){
    ctx.clearRect(0,0,w,h);
    for(let p of particles){
      p.x += p.vx; p.y += p.vy;
      if(p.x<0) p.x = w; if(p.x>w) p.x=0; if(p.y<0) p.y=h; if(p.y>h) p.y=0;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle = `rgba(255,255,255,${p.a})`; ctx.fill();
    }
    // connect some
    for(let i=0;i<particles.length;i++){
      for(let j=i+1;j<particles.length;j++){
        const p1=particles[i], p2=particles[j];
        const dx=p1.x-p2.x, dy=p1.y-p2.y, d=Math.sqrt(dx*dx+dy*dy);
        if(d<120){
          ctx.beginPath(); ctx.moveTo(p1.x,p1.y); ctx.lineTo(p2.x,p2.y);
          ctx.strokeStyle = `rgba(110,198,217,${0.02 + (0.12*(1 - d/120))})`; ctx.lineWidth=0.6; ctx.stroke();
        }
      }
    }
    requestAnimationFrame(draw);
  }
  init(); draw();
})();

/* ----------------- Meditation timer & sync ----------------- */
let timerSec = 300;
let timerInterval = null;
function pad(n){ return String(n).padStart(2,'0'); }
function updateDisplays(){
  const m = Math.floor(timerSec/60), s = timerSec%60;
  const text = `${pad(m)}:${pad(s)}`;
  const td = document.querySelector('.time-display #timeDisplay');
  // not present sometimes; update our explicit
  const timeSpan = document.getElementById('timeDisplay');
  if(timeSpan) timeSpan.textContent = text;
  document.getElementById('floatingTime').textContent = text;
  // style when finished
  if(timerSec <= 0){
    document.getElementById('floatingBtn').classList.add('finished');
    const mc = document.getElementById('medCircle'); if(mc) mc.style.border = '4px solid rgba(255,107,107,0.85)';
  } else {
    document.getElementById('floatingBtn').classList.remove('finished');
    const mc = document.getElementById('medCircle'); if(mc) mc.style.border = '0';
  }
}
function setTimer(sec){
  timerSec = sec;
  updateDisplays();
}
function startTimer(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    if(timerSec > 0){ timerSec--; updateDisplays(); }
    else { clearInterval(timerInterval); timerInterval=null; updateDisplays(); try{ new Audio('https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg').play(); }catch(e){} }
  },1000);
}
function stopTimer(){ if(timerInterval) clearInterval(timerInterval); timerInterval=null; updateDisplays(); }

/* UI bindings meditation */
document.getElementById('startBtn').addEventListener('click', ()=> { startTimer(); });
document.getElementById('stopBtn').addEventListener('click', ()=> { stopTimer(); });

document.getElementById('medCircle').addEventListener('click', ()=> {
  if(timerInterval) stopTimer(); else startTimer();
});

/* floating drag + click toggle */
let isDragging=false, offsetX=0, offsetY=0;
const floating = document.getElementById('floatingBtn');
floating.addEventListener('mousedown', e=>{ isDragging=true; offsetX=e.clientX-floating.offsetLeft; offsetY=e.clientY-floating.offsetTop; e.preventDefault(); });
document.addEventListener('mousemove', e=>{ if(!isDragging) return; floating.style.left=(e.clientX-offsetX)+'px'; floating.style.top=(e.clientY-offsetY)+'px'; });
document.addEventListener('mouseup', ()=> isDragging=false);
floating.addEventListener('touchstart', e=>{ isDragging=true; const t=e.touches[0]; offsetX=t.clientX-floating.offsetLeft; offsetY=t.clientY-floating.offsetTop; });
document.addEventListener('touchmove', e=>{ if(!isDragging) return; const t=e.touches[0]; floating.style.left=(t.clientX-offsetX)+'px'; floating.style.top=(t.clientY-offsetY)+'px'; });
document.addEventListener('touchend', ()=> isDragging=false);
floating.addEventListener('click', ()=> { if(isDragging) return; if(timerInterval) stopTimer(); else startTimer(); });

/* ---------- Frases diarias (30) ---------- */
const PHRASES = [
  "Respira profundo: cada aliento te ancla al presente.",
  "La calma nace cuando sueltas lo que no puedes controlar.",
  "Pequeños pasos hoy, grandes cambios mañana.",
  "La atención plena transforma lo cotidiano en sagrado.",
  "Acepta lo que eres; trabaja por lo que quieres ser.",
  "Cuando observes sin juzgar, la mente se serena.",
  "La gratitud abre puertas que la queja cierra.",
  "Escucha tu cuerpo: él te habla con calma.",
  "La paciencia es una forma de autocuidado.",
  "Vuelve a lo simple: ahí reside la claridad.",
  "Deja que el silencio te enseñe lo que las palabras no pueden.",
  "Cuidar de ti es un acto de amor hacia los demás.",
  "Haz una pausa: tu decisión será más clara después.",
  "La bondad empieza contigo mismo.",
  "Suelta el pasado; practica la presencia.",
  "Un minuto de respiración consciente renueva tu día.",
  "Permítete sentir sin definirlo todo.",
  "El descanso también es trabajo importante.",
  "Construye rituales que te devuelvan al centro.",
  "Menos prisa, más presencia.",
  "Observa tus pensamientos: no siempre son la verdad.",
  "Cada emoción es un mensajero: escúchala con curiosidad.",
  "El equilibrio se cultiva con pequeñas prácticas constantes.",
  "Al respirar, recuerda que siempre hay un nuevo comienzo.",
  "La ternura hacia ti cambia la forma en que ves el mundo.",
  "Siembra rutina, cosecha calma.",
  "No esperes permiso para cuidarte: date lo que necesitas.",
  "La claridad aparece cuando bajas el volumen interno.",
  "Encuentra asombro en lo sencillo.",
  "Tu ritmo no tiene que competir con nadie más."
];
let phraseIdx = Number(localStorage.getItem('coralma_phrase_idx') || 0);
const phraseBox = document.getElementById('phraseBox');
function showPhrase(i){
  if(!phraseBox) return;
  phraseBox.style.opacity = 0;
  setTimeout(()=>{ phraseBox.textContent = PHRASES[i % PHRASES.length]; phraseBox.style.opacity = 1; localStorage.setItem('coralma_phrase_idx', String(i % PHRASES.length)); }, 520);
}
showPhrase(phraseIdx);
setInterval(()=>{ phraseIdx = (phraseIdx + 1) % PHRASES.length; showPhrase(phraseIdx); }, 30000);

/* ---------- Articles: 5 with references ---------- */
const ARTICLES = [
  {source:'Wikipedia', title:'Meditación', extract:'Prácticas y técnicas para centrar la atención y lograr un estado de conciencia, tradiciones y estudios.', url:'https://es.wikipedia.org/wiki/Meditaci%C3%B3n'},
  {source:'Wikipedia', title:'Atención plena', extract:'(Mindfulness) — proceso de prestar atención de forma intencional en el presente.', url:'https://es.wikipedia.org/wiki/Atenci%C3%B3n_plena'},
  {source:'Wikipedia', title:'Neurociencia', extract:'Estudio del sistema nervioso con implicaciones en la comprensión de la meditación.', url:'https://es.wikipedia.org/wiki/Neurociencia'},
  {source:'Wikipedia', title:'Gratitud', extract:'Concepto y beneficios psicológicos asociados a la práctica de la gratitud.', url:'https://es.wikipedia.org/wiki/Gratitud'},
  {source:'Wikipedia', title:'Relajación (psicología)', extract:'Técnicas para reducir la tensión física y mental.', url:'https://es.wikipedia.org/wiki/Relajaci%C3%B3n'}
];
function renderArticles(){
  const grid = document.getElementById('articlesGrid');
  if(!grid) return;
  grid.innerHTML = '';
  ARTICLES.forEach(a=>{
    const card = document.createElement('div'); card.className='article-card';
    card.innerHTML = `<h3>${a.title}</h3><p>${a.extract}</p><div class="source">Fuente: ${a.source}</div><div style="margin-top:8px"><a class="read-btn" href="${a.url}" target="_blank" rel="noopener">Leer más</a></div>`;
    grid.appendChild(card);
  });
}
renderArticles();

/* ---------- YouTube search ---------- */
function ytSearch(){
  const q = document.getElementById('ytSearchInput').value.trim();
  if(!q) { loadDailyRecs(); return; }
  window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`, '_blank');
}

/* ---------- TAROT: single card, wikipedia fetch, glow energy frame, history ---------- */
/* Use a stable set of major arcana (Spanish names) + sample minors optional (kept maj + few minors to keep it light) */
const TAROT_POOL = [
  {name:'El loco', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/00_the_fool.jpg', wikiTitle:'El loco (tarot)'},
  {name:'El mago', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/01_the_magician.jpg', wikiTitle:'Mago (Tarot)'},
  {name:'La sacerdotisa', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/02_the_high_priestess.jpg', wikiTitle:'Sacerdotisa (tarot)'},
  {name:'La emperatriz', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/03_the_empress.jpg', wikiTitle:'Emperatriz (tarot)'},
  {name:'El emperador', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/04_the_emperor.jpg', wikiTitle:'Emperador (tarot)'},
  {name:'Los amantes', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/06_the_lovers.jpg', wikiTitle:'Amor (tarot)'},
  {name:'La estrella', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/17_the_star.jpg', wikiTitle:'Estrella (tarot)'},
  {name:'La luna', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/18_the_moon.jpg', wikiTitle:'Luna (tarot)'},
  {name:'El sol', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/19_the_sun.jpg', wikiTitle:'Sol (tarot)'},
  {name:'La muerte', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/13_death.jpg', wikiTitle:'Muerte (tarot)'},
  {name:'La torre', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/16_the_tower.jpg', wikiTitle:'Torre (tarot)'},
  {name:'El juicio', img:'https://raw.githubusercontent.com/ekelen/tarot-api/master/images/rws_major/20_judgement.jpg', wikiTitle:'Juicio (tarot)'},
  /* you can expand to full deck later */
];

/* choose orientation + card */
function pickCard(){
  const idx = Math.floor(Math.random() * TAROT_POOL.length);
  const chosen = TAROT_POOL[idx];
  const inverted = Math.random() < 0.5;
  return {chosen, inverted};
}

/* small energy classifier to decide glow color (green/yellow/red) */
function energyForCard(name){
  // simple mapping; adjust as needed
  const high = ['El sol','La estrella','Los amantes'];
  const low = ['La muerte','La torre'];
  if(high.includes(name)) return 'green';
  if(low.includes(name)) return 'red';
  return 'yellow';
}

/* cache wiki summaries in sessionStorage */
async function fetchWikiSummary(title){
  if(!title) return {text:'No hay descripción disponible.', source:''};
  const cacheKey = 'wiki_'+title.replace(/\s+/g,'_');
  const cached = sessionStorage.getItem(cacheKey);
  if(cached) return JSON.parse(cached);
  try{
    // try Spanish wiki first
    const esUrl = `https://es.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
    const res = await fetch(esUrl);
    if(res.ok){
      const j = await res.json();
      const out = {text: j.extract || 'No hay extracto en Wikipedia en español.', source: j.content_urls?.desktop?.page || ''};
      sessionStorage.setItem(cacheKey, JSON.stringify(out));
      return out;
    } else {
      // fallback: try english wiki by name
      const enUrl = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
      const r2 = await fetch(enUrl);
      if(r2.ok){ const j2 = await r2.json(); const out2 = {text:j2.extract || '', source:j2.content_urls?.desktop?.page||''}; sessionStorage.setItem(cacheKey, JSON.stringify(out2)); return out2; }
    }
  }catch(e){}
  return {text:'No se pudo recuperar la interpretación en este momento.', source:''};
}

/* persist + history (localStorage) */
function pushHistory(entry){
  try{
    const key = 'coralma_tarot_hist';
    const cur = JSON.parse(localStorage.getItem(key) || '[]');
    cur.unshift(entry);
    while(cur.length>5) cur.pop();
    localStorage.setItem(key, JSON.stringify(cur));
    renderHistory();
  }catch(e){}
}
function getHistory(){ try{ return JSON.parse(localStorage.getItem('coralma_tarot_hist')||'[]'); }catch(e){return [];} }
function renderHistory(){
  const container = document.getElementById('history');
  container.innerHTML = '';
  const hist = getHistory();
  hist.forEach(h=> {
    const d = document.createElement('div'); d.className='hist-thumb';
    const img = document.createElement('img'); img.src=h.img; img.alt=h.name;
    d.appendChild(img);
    d.title = h.name + (h.inverted? ' (invertida)':'');
    d.addEventListener('click', ()=> showCardFromHistory(h));
    container.appendChild(d);
  });
}
function showCardFromHistory(h){
  const cardReveal = document.getElementById('cardReveal');
  const tarotText = document.getElementById('tarotText');
  if(!cardReveal || !tarotText) return;
  document.getElementById('cardLoader').style.display='none';
  cardReveal.style.display='block'; cardReveal.src = h.img;
  if(h.inverted) cardReveal.classList.add('card-inverted'); else cardReveal.classList.remove('card-inverted');
  // apply glow class permanently
  cardReveal.classList.remove('glow-green','glow-yellow','glow-red');
  const color = energyForCard(h.name);
  if(color==='green') cardReveal.classList.add('glow-green');
  else if(color==='red') cardReveal.classList.add('glow-red');
  else cardReveal.classList.add('glow-yellow');
  tarotText.innerHTML = `<strong>${h.name}${h.inverted? ' (invertida)': ''}</strong><p style="margin-top:8px">${h.text}</p>${h.source? `<div style="margin-top:8px;font-size:12px;color:#9fd8ea">Fuente: <a href="${h.source}" target="_blank" style="color:#bfeffd">${h.source}</a></div>`: ''}`;
}

/* reveal card action */
document.getElementById('mazo').addEventListener('click', ()=> revealCardAction(false));
async function revealCardAction(pickManual){
  const cardReveal = document.getElementById('cardReveal');
  const tarotText = document.getElementById('tarotText');
  const cardLoader = document.getElementById('cardLoader');
  if(!cardReveal || !tarotText || !cardLoader) return;
  cardLoader.style.display = 'block'; cardReveal.style.display = 'none';
  let cardObj;
  if(pickManual && pickManual.img){ cardObj = {chosen: pickManual, inverted: Math.random() < 0.5}; }
  else cardObj = pickCard();
  // show image
  cardReveal.src = cardObj.chosen.img;
  // fetch wiki summary (prefer Spanish titles)
  const wikiTitle = cardObj.chosen.wikiTitle || cardObj.chosen.name;
  const res = await fetchWikiSummary(wikiTitle);
  // fade-in image
  cardLoader.style.display = 'none'; cardReveal.style.display = 'block'; cardReveal.style.opacity = 0;
  setTimeout(()=> cardReveal.style.opacity = 1, 80);
  // inverted class
  if(cardObj.inverted) cardReveal.classList.add('card-inverted'); else cardReveal.classList.remove('card-inverted');
  // apply glow color & fade-in effect (glow class left on permanently)
  cardReveal.classList.remove('glow-green','glow-yellow','glow-red');
  const energy = energyForCard(cardObj.chosen.name);
  if(energy==='green') { cardReveal.classList.add('glow-green'); }
  else if(energy==='red'){ cardReveal.classList.add('glow-red'); }
  else { cardReveal.classList.add('glow-yellow'); }
  // write text
  tarotText.innerHTML = `<strong>${cardObj.chosen.name}${cardObj.inverted? ' (invertida)':''}</strong><p style="margin-top:8px">${res.text || 'No hay extracto disponible.'}</p>${res.source? `<div style="margin-top:8px;font-size:12px;color:#9fd8ea">Fuente: <a href="${res.source}" target="_blank" style="color:#bfeffd">${res.source}</a></div>` : ''}`;
  // persist
  const entry = {img: cardObj.chosen.img, name: cardObj.chosen.name, inverted: cardObj.inverted, text: res.text, source: res.source, time: Date.now()};
  pushHistory(entry);
  try{ localStorage.setItem('coralma_last_card', JSON.stringify(entry)); }catch(e){}
}

/* deckGrid toggle + render full deck (using TAROT_POOL here; you can extend to 78) */
const deckGrid = document.getElementById('deckGrid');
document.getElementById('toggleDeckBtn').addEventListener('click', ()=>{
  if(deckGrid.style.display === 'none' || deckGrid.style.display === ''){ deckGrid.style.display='grid'; document.getElementById('toggleDeckBtn').textContent='Ocultar mazo'; if(deckGrid.childElementCount===0) renderDeck(); }
  else { deckGrid.style.display='none'; document.getElementById('toggleDeckBtn').textContent='Ver mazo completo'; }
});
function renderDeck(){
  TAROT_POOL.forEach(c=>{
    const d = document.createElement('div'); d.className='card-mini';
    const img = document.createElement('img'); img.src = c.img; img.alt = c.name;
    d.appendChild(img);
    d.addEventListener('click', ()=> revealCardAction(c));
    deckGrid.appendChild(d);
  });
}

/* on load, render history & persisted card if any */
(function initTarot(){
  renderHistory();
  const last = localStorage.getItem('coralma_last_card');
  if(last){
    try{
      const p = JSON.parse(last);
      if(p) setTimeout(()=> showCardFromHistory(p), 60);
    }catch(e){}
  }
})();

/* ---------- Misc: subscription, init ---------- */
document.getElementById('subForm').addEventListener('submit', e=>{ e.preventDefault(); document.getElementById('subInfo').textContent = '¡Gracias! Te hemos suscrito (demo)'; document.getElementById('emailInput').value=''; });

/* init displays */
function updateTimeDisplayInitial(){ updateDisplays(); }
updateTimeDisplayInitial();

/* prefetch tarot thumb images to reduce delay */
setTimeout(()=>{ TAROT_POOL.forEach(c=>{ const i=new Image(); i.src=c.img; }); },1500);

</script>
</body>
</html>