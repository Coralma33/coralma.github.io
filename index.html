<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>CorAlma — Encuentra tu calma</title>
<meta name="description" content="Meditaciones, sonidos y artículos con referencias científicas para cultivar presencia." />
<style>
:root{
  --bg1:#020414; --bg2:#041428;
  --accent1:#6ec6d9; --accent2:#8a6cff;
  --glass: rgba(255,255,255,0.04);
  --muted:#9fd8ea;
  --text:#e6f9ff;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background:
    radial-gradient(circle at 10% 10%, rgba(138,108,255,0.06), transparent 6%),
    radial-gradient(circle at 90% 70%, rgba(110,198,217,0.04), transparent 10%),
    linear-gradient(180deg,var(--bg1), var(--bg2));
  color:var(--text); -webkit-font-smoothing:antialiased;min-height:100vh;
}
.container{max-width:1180px;margin:28px auto;padding:18px}
header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;font-weight:700;color:#021018}
h1{font-size:18px;margin:0}
nav{display:flex;gap:10px;align-items:center}
nav a{color:#cfeffb;text-decoration:none;padding:8px 10px;border-radius:9px}
nav a:hover{background:var(--glass)}

/* hero */
.hero{margin-top:14px;border-radius:14px;padding:28px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));display:flex;gap:20px;align-items:center;position:relative;overflow:hidden}
.hero-left{flex:1;z-index:2}
.hero h2{margin:0;font-size:26px}
.hero p{margin-top:8px;color:#cfeff6}
.cta{margin-top:14px}
.btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#021018;padding:10px 16px;border-radius:12px;border:0;font-weight:700;cursor:pointer}

/* hero visuals */
.hero-visual{width:260px;display:flex;align-items:center;justify-content:center;z-index:1}

/* grid */
.grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-top:22px}
main{min-width:0}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:18px;border-radius:12px}
.med-card{max-width:760px;margin:0 auto;padding:22px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);box-shadow:0 10px 40px rgba(15,30,50,0.45)}
.center{display:flex;flex-direction:column;align-items:center;gap:12px}
.selector-row{display:flex;gap:10px;align-items:center;width:100%;justify-content:center;flex-wrap:wrap}
select{background:transparent;color:#dff8ff;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)}
.timer-btns{display:flex;gap:8px}
.timer-btns button{padding:8px 12px;border-radius:10px;border:0;background:rgba(255,255,255,0.03);color:#dff8ff;cursor:pointer}
.time-display{font-weight:700}

/* circular CTA */
.med-circle{width:170px;height:170px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent2),var(--accent1));color:#021018;font-weight:700;font-size:16px;cursor:pointer;box-shadow:0 12px 40px rgba(60,80,120,0.18);transition:transform .18s ease, box-shadow .18s}
.med-circle:hover{transform:scale(1.03)}
.pulse { animation: pulse 2000ms infinite; }
@keyframes pulse {0%{box-shadow:0 8px 28px rgba(138,108,255,0.22)}50%{box-shadow:0 18px 44px rgba(110,198,217,0.20)}100%{box-shadow:0 8px 28px rgba(138,108,255,0.22)}}

/* articles */
.articles-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:12px}
.article-card{padding:14px;border-radius:10px;background:rgba(255,255,255,0.01);text-align:left}
.article-card h3{margin:0 0 8px 0}
.article-card p{margin:0;color:#cfeef7}
.read-btn{margin-top:10px;padding:8px 10px;border-radius:10px;border:0;background:rgba(255,255,255,0.04);color:#dff8ff;cursor:pointer}

/* right side */
aside{position:relative}
.side-block{display:flex;flex-direction:column;gap:14px}
.sounds-list{max-height:320px;overflow:auto;padding-right:6px}
.sound-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01)}

/* footer */
footer{margin-top:28px;padding:18px 0;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
.socials{display:flex;gap:12px}
.socials a{display:inline-flex;align-items:center;justify-content:center;width:38px;height:38px;border-radius:8px;background:rgba(255,255,255,0.03)}
.socials svg{width:20px;height:20px;fill:#e6f9ff}

/* modal */
.modal-back{position:fixed;inset:0;background:rgba(0,6,12,0.65);display:none;align-items:center;justify-content:center;padding:18px;z-index:80}
.modal-back.on{display:flex}
.modal{background:linear-gradient(180deg,#031425,#041a2a);border-radius:12px;padding:18px;max-width:920px;width:100%;max-height:90vh;overflow:auto}
.modal h2{margin-top:0}
.refs{margin-top:18px;border-top:1px dashed rgba(255,255,255,0.03);padding-top:12px}

/* floating sidebar */
.floating-sidebar{position:fixed;right:12px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:10px;z-index:1000}
.floating-btn{width:44px;height:44px;border-radius:10px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .18s}
.floating-btn:hover{transform:scale(1.08);background:rgba(255,255,255,0.08)}

/* webview banner */
.webview-banner{position:fixed;left:12px;right:12px;bottom:12px;background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#021018;padding:10px 12px;border-radius:12px;display:none;z-index:90;box-shadow:0 12px 40px rgba(10,20,40,0.5)}
.webview-banner button{margin-left:12px;background:transparent;border:1px solid rgba(2,16,24,0.08);padding:6px 8px;border-radius:8px;cursor:pointer}

/* stars animation */
.stars { position:absolute; inset:0; pointer-events:none; z-index:0; opacity:0.28 }
.star { fill: white; opacity:0.9; filter: blur(0.6px); transform-origin:center; animation: twinkle 4s infinite; }
@keyframes twinkle { 0%{opacity:0.7} 50%{opacity:1} 100%{opacity:0.7} }

/* planet float */
.planet { animation: floatPlanet 8s ease-in-out infinite; transform-origin:center; }
@keyframes floatPlanet { 0%{transform:translateY(0)}50%{transform:translateY(-8px)}100%{transform:translateY(0)} }

@media(max-width:980px){.grid{grid-template-columns:1fr}.articles-grid{grid-template-columns:1fr}.hero{flex-direction:column}.med-card{width:100%}}
@media(max-width:520px){.med-circle{width:150px;height:150px;font-size:14px}}
button:focus, a:focus { outline: 2px dashed rgba(110,198,217,0.35); outline-offset: 3px; }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">CA</div>
        <div>
          <h1>CorAlma</h1>
          <div style="font-size:12px;color:#bfeffd">Encuentra tu calma en el universo interior</div>
        </div>
      </div>
      <nav>
        <a href="#">Inicio</a>
        <a href="#medit-block">Meditación</a>
        <a href="#art">Artículos</a>
        <a href="#reg">Registro</a>
        <a href="#don">Donaciones</a>
        <a href="#contact">Contacto</a>
      </nav>
    </header>

    <!-- HERO -->
    <section class="hero" aria-labelledby="hero-title">
      <div class="hero-left">
        <h2 id="hero-title">Encuentra calma y presencia con prácticas basadas en ciencia y tradición</h2>
        <p>Sonidos curados, meditaciones guiadas y artículos con referencias científicas para sostener tu práctica.</p>
        <div class="cta"><button class="btn-primary" onclick="document.getElementById('medit-block').scrollIntoView({behavior:'smooth'})">Iniciar Meditación</button></div>
      </div>

      <!-- planet + stars visual -->
      <div class="hero-visual" aria-hidden="true">
        <svg width="260" height="260" viewBox="0 0 200 200">
          <g class="stars">
            <circle class="star" cx="20" cy="30" r="1.6" style="animation-delay:0s"/>
            <circle class="star" cx="40" cy="70" r="1.2" style="animation-delay:0.8s"/>
            <circle class="star" cx="80" cy="20" r="1.4" style="animation-delay:1.2s"/>
            <circle class="star" cx="150" cy="50" r="1.8" style="animation-delay:0.3s"/>
            <circle class="star" cx="170" cy="120" r="1.3" style="animation-delay:1.7s"/>
            <circle class="star" cx="110" cy="150" r="1.1" style="animation-delay:2.4s"/>
            <circle class="star" cx="30" cy="140" r="1.5" style="animation-delay:1.1s"/>
          </g>

          <g class="planet" transform="translate(40,20)">
            <defs>
              <linearGradient id="pgrad" x1="0" x2="1">
                <stop offset="0" stop-color="#6ec6d9"/>
                <stop offset="1" stop-color="#8a6cff"/>
              </linearGradient>
            </defs>
            <circle cx="60" cy="60" r="50" fill="url(#pgrad)" opacity="0.95"/>
            <ellipse cx="60" cy="68" rx="62" ry="14" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="2" transform="rotate(-18 60 60)"/>
            <circle cx="42" cy="50" r="6" fill="rgba(255,255,255,0.06)"/>
          </g>
        </svg>
      </div>
    </section>

    <!-- MAIN GRID -->
    <div class="grid">
      <main>
        <!-- Meditation card (central) -->
        <section id="medit-block" class="card med-card" aria-labelledby="medit-title">
          <div style="display:flex;flex-direction:column;gap:8px;align-items:center">
            <h3 id="medit-title" style="margin:0">Meditación interactiva</h3>
            <p style="margin:0;color:#cfeef7">Selecciona sonido, elige duración y haz click en el círculo para comenzar.</p>

            <div class="selector-row" style="margin-top:12px">
              <label for="soundSelect" style="color:#bfeffd">Selecciona sonido</label>
              <select id="soundSelect" aria-label="Selecciona sonido"></select>
            </div>

            <div class="selector-row" style="margin-top:6px">
              <div class="timer-btns" role="group" aria-label="Duraciones">
                <button onclick="setTimer(300)">5 min</button>
                <button onclick="setTimer(600)">10 min</button>
                <button onclick="setTimer(900)">15 min</button>
              </div>
              <div style="flex:1"></div>
              <div class="time-display" aria-live="polite">Tiempo: <span id="timeDisplay">00:00</span></div>
            </div>

            <!-- Circular CTA -->
            <div style="margin-top:14px" class="center">
              <div id="medCircle" class="med-circle pulse" role="button" aria-label="Click aquí para meditar" tabindex="0">
                Click aquí<br><span style="font-size:12px;opacity:0.9">para meditar</span>
              </div>
            </div>

            <!-- controls -->
            <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
              <button id="startBtn" class="btn-primary">Iniciar</button>
              <button id="stopBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfeef7;padding:8px 12px;border-radius:10px">Detener</button>
            </div>

            <div style="margin-top:18px;text-align:center;color:#bfeffd;font-size:13px">
              <div style="font-weight:700">Círculo interactivo</div>
              <div style="opacity:0.9">Haz click en el círculo o en «Iniciar» para comenzar la meditación; el temporizador te guiará.</div>
            </div>

            <!-- hidden audio -->
            <audio id="audioPlayer" preload="none" controls style="display:none"></audio>
          </div>
        </section>

        <!-- ARTICLES -->
        <section class="card" style="margin-top:16px" id="art">
          <h3 style="margin-top:0">Artículos</h3>
          <div class="articles-grid" id="articlesGrid" role="list"></div>
        </section>
      </main>

      <!-- RIGHT / SIDEBAR -->
      <aside>
        <div class="side-block">
          <div class="card" aria-labelledby="sounds-title">
            <h4 id="sounds-title" style="margin-top:0">Selector de sonidos</h4>
            <div class="sounds-list" id="soundsList">Cargando pistas... (se obtienen automáticamente desde archive.org)</div>
          </div>

          <div class="card" id="reg">
            <h4 style="margin-top:0">Registro / Frase mensual</h4>
            <form id="subForm">
              <input id="emailInput" type="email" placeholder="tu@correo.com" required style="width:100%;padding:10px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);color:#dff8ff">
              <div style="margin-top:10px"><button class="btn-primary" type="submit">Suscribirme</button></div>
            </form>
            <div id="subInfo" style="margin-top:12px;color:#bfeffd"></div>
          </div>

          <div class="card" id="don">
            <h4 style="margin-top:0">Donaciones</h4>
            <p style="margin:0 0 10px 0;color:#cfeef7">Si valoras este proyecto, apóyalo. Las donaciones mantienen el contenido libre.</p>
            <!-- Replace the href with your PayPal donate link if you have a specific one -->
            <a class="btn-primary" href="https://www.paypal.com/donate" target="_blank" rel="noopener">Donar con PayPal</a>
          </div>
        </div>
      </aside>
    </div>

    <!-- footer / contacto -->
    <footer id="contact">
      <div style="color:#9fd8ea">
        Contacto: <a href="mailto:almacoralma@gmail.com">almacoralma@gmail.com</a>
      </div>
      <div class="socials" aria-label="Redes sociales">
        <a href="https://www.instagram.com/effectno33?igsh=MjAycWE4dTFsbXpw" target="_blank" rel="noopener" title="Instagram">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5a4.5 4.5 0 1 1 0 9 4.5 4.5 0 0 1 0-9zM18.5 6a.9.9 0 1 1 0 1.8.9.9 0 0 1 0-1.8z" fill="#e6f9ff"/></svg>
        </a>
        <a href="https://www.tiktok.com/@effect.33?_t=ZS-8znP36atx8n&_r=1" target="_blank" rel="noopener" title="TikTok">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15 2v7.1a4.5 4.5 0 0 1-4.5-4.5H9A6 6 0 1 0 15 15.9V9h3V2h-3z" fill="#e6f9ff"/></svg>
        </a>
        <a href="https://youtube.com/@effect.no33?si=5A83WFm9vvf_DBRv" target="_blank" rel="noopener" title="YouTube">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M23 7s-.2-1.6-1-2.3c-.9-.9-1.9-.9-2.4-1C16.9 3 12 3 12 3s-4.9 0-7.6.7c-.5.1-1.4.1-2.4 1C1.2 5.4 1 7 1 7S1 8.9 1.1 10.8c.1 1.9.5 2.8 1.1 3.6.9 1.1 2.2 1.1 2.8 1.2 2.1.2 8 .6 8 .6s4.9-.2 7.6-.8c.5-.1 1.9-.1 2.8-1.2.6-.8 1-1.7 1.1-3.6C23 8.9 23 7 23 7zM9.8 15.2V8.8l6 3.2-6 3.2z" fill="#e6f9ff"/></svg>
        </a>
      </div>
    </footer>
  </div>

  <!-- floating sidebar (socials only) -->
  <div class="floating-sidebar" aria-hidden="false">
    <a class="floating-btn" href="https://www.instagram.com/effectno33?igsh=MjAycWE4dTFsbXpw" target="_blank" title="Instagram" rel="noopener" aria-label="Instagram">
      <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5a4.5 4.5 0 1 1 0 9 4.5 4.5 0 0 1 0-9zM18.5 6a.9.9 0 1 1 0 1.8.9.9 0 0 1 0-1.8z" fill="#e6f9ff"/></svg>
    </a>
    <a class="floating-btn" href="https://www.tiktok.com/@effect.33?_t=ZS-8znP36atx8n&_r=1" target="_blank" title="TikTok" rel="noopener" aria-label="TikTok">
      <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path d="M15 2v7.1a4.5 4.5 0 0 1-4.5-4.5H9A6 6 0 1 0 15 15.9V9h3V2h-3z" fill="#e6f9ff"/></svg>
    </a>
    <a class="floating-btn" href="https://youtube.com/@effect.no33?si=5A83WFm9vvf_DBRv" target="_blank" title="YouTube" rel="noopener" aria-label="YouTube">
      <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path d="M23 7s-.2-1.6-1-2.3c-.9-.9-1.9-.9-2.4-1C16.9 3 12 3 12 3s-4.9 0-7.6.7c-.5.1-1.4.1-2.4 1C1.2 5.4 1 7 1 7S1 8.9 1.1 10.8c.1 1.9.5 2.8 1.1 3.6.9 1.1 2.2 1.1 2.8 1.2 2.1.2 8 .6 8 .6s4.9-.2 7.6-.8c.5-.1 1.9-.1 2.8-1.2.6-.8 1-1.7 1.1-3.6C23 8.9 23 7 23 7zM9.8 15.2V8.8l6 3.2-6 3.2z" fill="#e6f9ff"/></svg>
    </a>
  </div>

  <!-- modal -->
  <div id="modalBack" class="modal-back" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h2 id="modalTitle"></h2>
      <div id="modalBody" style="color:#dffcff;line-height:1.6"></div>
      <div id="modalRefs" class="refs" style="color:#bfeffd"></div>
      <div style="text-align:right;margin-top:12px">
        <button id="closeModal" class="btn-primary" style="background:transparent;color:#bfeffd;border:1px solid rgba(255,255,255,0.06)">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- webview banner -->
  <div id="webviewBanner" class="webview-banner" role="status">
    Para una mejor experiencia abre esta página en tu navegador (Chrome o Safari).
    <button id="dismissWebview">Cerrar</button>
  </div>

<script>
/*
  CorAlma - Single-file HTML
  - Carga dinámica de pistas (20): 10 ambient + 10 clásicas desde archive.org
  - 30 artículos (mezcla espiritual + científico) ya incluidos abajo
  - Meditación con círculo, timer, start/stop
  - Suscripción (localStorage) y frase mensual
  - Donaciones PayPal (link)
  - Floating socials and WebView detection
*/

/* -------------------------
   Articles data (30 full entries)
   (mix spiritual + scientific; titles/excerpts/content/refs)
   For brevity here we include full content for each article.
   ------------------------- */
const ARTICLES = [
  {id:1,title:"Respira: el primer acto de presencia",excerpt:"La respiración es la puerta de entrada al presente. Prácticas simples regulan el sistema nervioso.",content:`La respiración es la ancla que trae la atención al momento presente. Respirar de forma consciente —inhalando lento y profundo, permitiendo la exhalación completa— activa el sistema nervioso parasimpático, reduciendo la frecuencia cardiaca y la sensación de alerta. Estudios sobre respiración diafragmática muestran mejoras en la variabilidad de la frecuencia cardiaca y en la regulación emocional. Practicar 5 minutos al día con intención produce cambios en la percepción del estrés y en la capacidad de respuesta ante desafíos cotidianos.`,refs:["Brown, R. P., & Gerbarg, P. L. (2005). Sudarshan Kriya yogic breathing: physiology and clinical applications.","Harvard Health Publishing — Relaxation techniques: Breath control helps quell errant stress response."]},
  {id:2,title:"Micro-prácticas para la calma",excerpt:"Pequeñas pausas a lo largo del día suman más que sesiones largas y esporádicas.",content:`Las micro-prácticas son intervenciones breves (30-120 segundos) que permiten reconectar con la respiración, el cuerpo y el entorno. Investigaciones en entornos laborales muestran que pausas cortas frecuentes reducen la fatiga mental y mejoran la productividad. Incorporar rituales sencillos —beber agua con atención, una respiración consciente antes de reuniones— favorece la continuidad de la atención plena a lo largo del día.`,refs:["Sonnentag, S. (2018). Recovery from work-related effort: Review and future directions.","American Psychological Association — resources on breaks and attention."]},
  {id:3,title:"Música clásica como paisaje interior",excerpt:"El tempo, la armonía y el timbre influyen en la regulación emocional durante la práctica.",content:`La música clásica, en particular piezas lentas de piano o cuerdas, puede facilitar estados de relajación al ofrecer estructura y previsibilidad sonora. La neurociencia muestra que la música moduladora de tempo reduce la actividad en redes de estrés y facilita la sincronización interoceptiva. Escuchar composiciones suaves durante la meditación puede actuar como ancla auditiva y sostén emocional.`,refs:["Juslin, P. N., & Västfjäll, D. (2008). Emotional responses to music: The need to consider underlying mechanisms.","Musopen — public-domain classical recordings."]},
  {id:4,title:"El poder del anclaje ritual",excerpt:"Rituales simples (vela, postura, tiempo) condicionan al cuerpo para la práctica.",content:`Los rituales marcan el inicio de una actividad y activan señales condicionadas en el sistema límbico. Encender una vela, preparar un cojín o elegir una pista musical concreta son acciones que envían al cerebro la señal de que es tiempo de bajar la alerta y volver a la interioridad. Con el tiempo, estos condicionamientos facilitan el acceso al estado meditativo.`,refs:["Kabat-Zinn, J. (1990). Full Catastrophe Living.","Journal of Behavioral Medicine — studies on ritual and stress response."]},
  {id:5,title:"Atención plena y toma de decisiones",excerpt:"Practicar mindfulness mejora la claridad y reduce la impulsividad en la toma de decisiones.",content:`La atención plena entrena la capacidad de observar pensamientos y emociones sin identificarse con ellos, lo que reduce la reactividad. Estudios muestran mejoras en la toma de decisiones y en la regulación emocional tras programas de 8 semanas de mindfulness. Al crear una distancia entre estímulo y respuesta, es más fácil elegir acciones alineadas con valores a largo plazo.`,refs:["Kiken, L. G., Garland, E. L., Bluth, K., Palsson, O. S., & Gaylord, S. A. (2015). From a state to a trait: Trajectories of state mindfulness in meditation during intervention.","Jon Kabat-Zinn (1994). Wherever You Go, There You Are."]},
  {id:6,title:"Sueño y prácticas previas",excerpt:"Meditaciones breves antes de dormir mejoran la calidad del sueño.",content:`Practicar ejercicios de relajación o respiraciones lentas antes de acostarse ayuda a reducir la activación fisiológica y a preparar el cuerpo para el sueño. Intervenciones basadas en mindfulness han mostrado mejoras en parámetros subjetivos del sueño, así como en la latencia de inicio del mismo.`,refs:["Harvard Medical School — Sleep and Mental Health resources.","Ong, J. C., et al. (2014). Mindfulness-based therapy for insomnia."]},
  {id:7,title:"Movimiento consciente",excerpt:"Yoga suave, tai chi y caminata consciente integran cuerpo y mente.",content:`La atención plena en movimiento permite llevar presencia al cuerpo, desbloquear tensiones y cultivar una relación más amable con la sensación física. La investigación sobre yoga y tai chi indica beneficios en equilibrio, reducción de estrés y mejor autonomía funcional.`,refs:["Field, T. (2016). Yoga research review.","WHO guidance on physical activity and mental health."]},
  {id:8,title:"Compasión hacia uno mismo",excerpt:"La práctica de la autocompasión reduce la crítica interna y la rumia.",content:`Cultivar una voz interna compasiva modifica los patrones cognitivos que alimentan la culpa y la autoexigencia. Programas como Mindful Self-Compassion (Neff & Germer) han mostrado reducir síntomas de depresión y ansiedad, promoviendo bienestar emocional.`,refs:["Neff, K. (2011). Self-Compassion.","Germer, C. K., & Neff, K. (2013). Mindful self-compassion: A sourcebook."]},
  {id:9,title:"Atención en tareas cotidianas",excerpt:"Practicar en lo cotidiano transforma la percepción de la vida ordinaria.",content:`Incorporar atención plena en actividades simples —lavarse las manos, comer, caminar— convierte lo rutinario en práctica sostenida. Estudios en psicología aplicada muestran que la atención mantenida durante tareas rápidas mejora la calidad de la ejecución y la satisfacción.`,refs:["Dreyfus, G. (2011). Is mindfulness present-centred and non-judgmental?"]},
  {id:10,title:"Respiración coherente",excerpt:"Sincronizar respiración y ritmo cardiaco mejora la estabilidad emocional.",content:`La coherencia cardiaca (respiración rítmica y sincronizada) se relaciona con estados de calma y mejor regulación emocional. Practicar ciclos respiratorios regulares favorece la resiliencia y la claridad mental.`,refs:["McCraty, R. (2017). Heart rate variability and coherence: implications for health.","National Institutes of Health — HRV studies."]},
  {id:11,title:"Meditaciones guiadas vs silencio",excerpt:"Ambas tienen beneficios; alternarlas optimiza el aprendizaje.",content:`Las meditaciones guiadas ayudan especialmente a principiantes al ofrecer estructura y soporte verbal. El silencio cultivado permite una escucha más profunda. Alternar ambos formatos en la práctica personal enriquece la destreza atencional.`,refs:["Tang, Y.-Y., Hölzel, B. K., & Posner, M. I. (2015). The neuroscience of mindfulness meditation."]},
  {id:12,title:"Efecto de la música en la atención",excerpt:"El tipo de música importa: textura, tempo y timbre influyen en la práctica.",content:`No toda música es adecuada para meditar. Piezas con tempo estable y dinámica suave suelen facilitar el descenso de la activación. Investigaciones en musicoterapia detallan cómo ciertos timbres promueven estados de relajación.`,refs:["Bradt, J., Dileo, C., & Shim, M. (2013). Music interventions for psychological outcomes."]},
  {id:13,title:"Visualizaciones cósmicas",excerpt:"Imaginar expansión y conexión con el cosmos puede reducir la rumiación.",content:`Las visualizaciones que integran imágenes amplias (cielo, planeta, universo) ofrecen perspectiva y sentido de pertenencia, disminuyendo la fijación en problemas personales. Técnicas de compasión y visualización han mostrado eficacia en la reducción del estrés.`,refs:["Fredrickson, B. L. (2001). The role of positive emotions in positive psychology."]},
  {id:14,title:"Atención y creatividad",excerpt:"Estados de atención abierta facilitan asociaciones nuevas y originales.",content:`La práctica de la atención no solo reduce el estrés sino que amplía la capacidad de ver conexiones no evidentes. Estudios en creatividad indican que la atención abierta (open monitoring) favorece la flexibilidad cognitiva.`,refs:["Colzato, L. S., & Hommel, B. (2014). Meditation and creativity."]},
  {id:15,title:"Rutinas para empezar",excerpt:"Crear pequeños rituales facilita la adherencia a la práctica diaria.",content:`La formación de hábitos requiere señales y recompensas. Asociar la práctica a un estímulo fijo (hora del día, encender una vela) ayuda a consolidarla. La ciencia del hábito recomienda comenzar con objetivos modestos y aumentar gradualmente.`,refs:["Duhigg, C. (2012). The Power of Habit.","Lally, P., van Jaarsveld, C. H. M., Potts, H. W. W., & Wardle, J. (2010). How are habits formed: Modelling habit formation in the real world."]},
  {id:16,title:"Mindfulness y rendimiento laboral",excerpt:"Pausas conscientes aumentan la eficiencia y reducen el agotamiento.",content:`Programas de mindfulness en empresas han mostrado reducir el burnout y mejorar la atención. Las micro-pausas intencionales contribuyen a un mejor rendimiento cognitivo y mayor claridad en la toma de decisiones.`,refs:["Good et al. (2016). Impact of mindfulness training on workplace outcomes."]},
  {id:17,title:"Regulación emocional",excerpt:"La práctica sostenida modifica circuitos neuronales relacionados con la emoción.",content:`La evidencia neurocientífica muestra que la práctica sostenida de mindfulness puede reducir la reactividad de la amígdala y fortalecer redes prefrontales asociadas a la regulación emocional. Esto se traduce en mayor estabilidad ante estímulos estresantes.`,refs:["Hölzel et al. (2011). Mindfulness practice leads to increases in regional brain gray matter density."]},
  {id:18,title:"Meditación y salud física",excerpt:"Beneficios en inflamación, presión arterial y control del dolor.",content:`Diversos estudios señalan efectos moderados de la meditación en marcadores inflamatorios, control del dolor y regulación de la presión arterial. La meditación no sustituye tratamientos médicos pero puede ser una herramienta complementaria valiosa.`,refs:["Black, D. S., & Slavich, G. M. (2016). Mindfulness meditation and the immune system.","NIH — Complementary and Integrative Health."]},
  {id:19,title:"Escucha profunda",excerpt:"La atención plena mejora la calidad de las relaciones a través de la escucha activa.",content:`Practicar la presencia reduce la impulsividad en la conversación y aumenta la capacidad de escucha. Estudios en terapia muestran que la presencia del terapeuta mejora la alianza terapéutica; similarmente, la confianza interpersonal mejora cuando practicamos la escucha consciente.`,refs:["Rogers, C. (1957). The necessary and sufficient conditions of therapeutic personality change.","Goleman, D. (1995). Emotional Intelligence."]},
  {id:20,title:"Gratitud y bienestar",excerpt:"Practicar gratitud recalibra la atención hacia lo positivo y mejora el ánimo.",content:`Terminar la práctica con tres cosas por las que estás agradecido recalibra la percepción hacia lo positivo y crea un cierre afectivo que puede sostener el día.`,refs:["Emmons, R. A., & McCullough, M. E. (2003). Counting blessings vs. burdens.","Harvard Health Publishing — Benefits of gratitude."]},
  {id:21,title:"Prácticas para la ansiedad",excerpt:"Herramientas prácticas que ayudan a reducir la activación anticipatoria.",content:`La combinación de respiración lenta, activación física moderada y prácticas de exposición gradual produce reducciones significativas en la ansiedad. Intervenciones basadas en mindfulness se integran bien con terapias cognitivo-conductuales para casos moderados de ansiedad.`,refs:["Bishop, S. R. (2004). Mindfulness: A proposed operational definition.","NIH — Anxiety disorder resources."]},
  {id:22,title:"Atención y tecnología",excerpt:"Límites digitales protegen la atención y la energía mental.",content:`Reducir notificaciones, programar bloques sin pantallas y practicar pausas intencionales mejora la capacidad de concentración. Estudios sobre multitarea indican que saltar entre tareas reduce la eficiencia y aumenta el desgaste cognitivo.`,refs:["Rosen, L. D., et al. (2013). The distracted mind."]},
  {id:23,title:"Meditación en movimiento",excerpt:"Integrar movimiento y atención profundiza la presencia en el cuerpo.",content:`Modalidades que integran movimiento (caminar conscientemente, yin yoga, tai chi) ofrecen alternativas para quienes encuentran difícil permanecer inmóviles. Estos enfoques trabajan la propriocepción y la regulación emocional en simultáneo.`,refs:["Wang, C., et al. (2010). Tai chi and health outcomes."]},
  {id:24,title:"Autocompasión y resiliencia",excerpt:"La autocompasión potencia la recuperación ante adversidades.",content:`La práctica de autocompasión actúa como amortiguador frente a la autocrítica y favorece la recuperación emocional tras fracasos o pérdidas. Programas estructurados muestran mejoras en indicadores de resiliencia.`,refs:["Neff, K., & Germer, C. (2013). Mindful Self-Compassion program.","APA resources on resilience."]},
  {id:25,title:"Prácticas breves para el trabajo",excerpt:"Micro-meditaciones que puedes integrar en la jornada laboral.",content:`Pausas de 1-3 minutos para centrar la respiración o revisar la postura ofrecen beneficios inmediatos en claridad mental y disminución del estrés. Estas prácticas son fáciles de implementar y sostenibles en el tiempo.`,refs:["Good et al. (2016). Workplace mindfulness effects.","Harvard Business Review — microbreaks research."]},
  {id:26,title:"Meditación y creatividad",excerpt:"Estados serenos facilitan la generación de ideas no lineales.",content:`Reducir la presión evaluativa y cultivar un espacio mental abierto aumenta la probabilidad de generar ideas originales. Prácticas de atención abierta favorecen la asociación libre y la creatividad fluida.`,refs:["Colzato, L. S., et al. (2012). Meditation styles and creative thinking."]},
  {id:27,title:"Vínculo con la naturaleza",excerpt:"La naturaleza amplifica los efectos regenerativos de la meditación.",content:`Estar en espacios naturales potencia la recuperación atencional y reduce activación fisiológica. Combinar meditación con paseos al aire libre amplifica beneficios en salud mental.`,refs:["Kaplan, S. (1995). The restorative benefits of nature.","WHO — Nature and mental health evidence."]},
  {id:28,title:"Meditación para el dolor crónico",excerpt:"Herramienta complementaria en manejo del dolor a largo plazo.",content:`Intervenciones como MBSR se han estudiado en poblaciones con dolor crónico, mostrando reducción en la percepción del dolor y mejor calidad de vida. La meditación facilita la relación con la sensación dolorosa sin aumentar la evasión.`,refs:["Cherkin, D. C., et al. (2016). Effect of mindfulness-based stress reduction vs cognitive behavioral therapy among patients with chronic low back pain.","NIH — pain management resources."]},
  {id:29,title:"La actitud de principiante",excerpt:"Abrirse a la experiencia sin prejuicios reaviva la curiosidad y la presencia.",content:`Adoptar una actitud de principiante (beginner's mind) permite ver detalles nuevos en situaciones conocidas. Esta disposición atencional promueve aprendizaje y reduce la rigidez mental.`,refs:["Suzuki, S. (1970). Zen Mind, Beginner's Mind.","Kabat-Zinn, J. (1994). Wherever You Go, There You Are."]},
  {id:30,title:"Pequeñas ceremonias, grandes efectos",excerpt:"Repetir rituales simples acumula memoria emocional y facilita el cambio.",content:`Las ceremonias cotidianas (preparar un espacio, seleccionar una canción, encender una vela) crean anclas emocionales que facilitan el acceso a estados internos deseados. La repetición sostenida permite que el cuerpo y la mente reconozcan y respondan eficientemente a la señal de práctica.`,refs:["Duhigg, C. (2012). The Power of Habit.","Kabat-Zinn, J. (1990). Full Catastrophe Living."]}
];

/* -------------------------
   DOM refs
   ------------------------- */
const soundSelect = document.getElementById('soundSelect');
const soundsList = document.getElementById('soundsList');
const audioPlayer = document.getElementById('audioPlayer');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const timeDisplay = document.getElementById('timeDisplay');
const medCircle = document.getElementById('medCircle');
const articlesGrid = document.getElementById('articlesGrid');
const modalBack = document.getElementById('modalBack');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
const modalRefs = document.getElementById('modalRefs');
const closeModal = document.getElementById('closeModal');
const subForm = document.getElementById('subForm');
const emailInput = document.getElementById('emailInput');
const subInfo = document.getElementById('subInfo');
const webviewBanner = document.getElementById('webviewBanner');
const dismissWebview = document.getElementById('dismissWebview');

/* -------------------------
   Helpers: Archive.org dynamic fetch
   - We query archive.org advancedsearch for tags and then request metadata
   - Goal: get 10 ambient/nature + 10 classical/piano tracks (mp3/ogg)
   ------------------------- */

async function archiveSearch(query, rows=20) {
  const endpoint = 'https://archive.org/advancedsearch.php';
  const q = encodeURIComponent(query);
  const url = `${endpoint}?q=${q}&fl[]=identifier,subject,title,mediatype&rows=${rows}&page=1&output=json`;
  const res = await fetch(url);
  if(!res.ok) throw new Error('Error archive search');
  return await res.json();
}

// Given an identifier, get metadata and return the first playable file url (.mp3 or .ogg)
async function getPlayableUrl(identifier) {
  const metaUrl = `https://archive.org/metadata/${identifier}`;
  try {
    const r = await fetch(metaUrl);
    if(!r.ok) return null;
    const md = await r.json();
    if(!md || !md.files) return null;
    // Prefer mp3, then ogg
    for(const f of md.files) {
      if(f.name && /\.mp3$/i.test(f.name)) {
        return `https://archive.org/download/${identifier}/${encodeURIComponent(f.name)}`;
      }
    }
    for(const f of md.files) {
      if(f.name && /\.ogg$/i.test(f.name)) {
        return `https://archive.org/download/${identifier}/${encodeURIComponent(f.name)}`;
      }
    }
    // fallback: look for any audio mime
    for(const f of md.files) {
      if(f.format && /audio/i.test(f.format)) {
        return `https://archive.org/download/${identifier}/${encodeURIComponent(f.name)}`;
      }
    }
    return null;
  } catch(err) {
    return null;
  }
}

// Build the sounds list: 10 ambient + 10 classical
async function buildSounds() {
  const ambientQuery = 'subject:ambient OR subject:nature OR title:ambient OR description:ambient';
  const classicalQuery = 'subject:classical OR subject:piano OR title:classical OR title:piano';

  // Search both (we request a larger rows so we can filter)
  const [ambRes, clsRes] = await Promise.all([
    archiveSearch(ambientQuery, 40).catch(()=>null),
    archiveSearch(classicalQuery, 40).catch(()=>null)
  ]);

  const ambientIds = (ambRes && ambRes.response && ambRes.response.docs) ? ambRes.response.docs.map(d=>d.identifier) : [];
  const classicalIds = (clsRes && clsRes.response && clsRes.response.docs) ? clsRes.response.docs.map(d=>d.identifier) : [];

  const sounds = [];
  // helper to fill from ids
  async function fillFromIds(ids, targetCount, labelPrefix) {
    for(const id of ids) {
      if(sounds.length >= targetCount) break;
      const url = await getPlayableUrl(id);
      if(url) {
        // friendly title
        const title = `${labelPrefix} — ${id}`;
        sounds.push({ id: sounds.length+1, title, src: url, dur: 180 });
      }
    }
  }

  // We want 10 ambient + 10 classical (20 total)
  await fillFromIds(ambientIds, 10, 'Ambient');
  await fillFromIds(classicalIds, 20, 'Clásica/Piano'); // fill remaining to reach 20

  // If still <20, try other queries (muted fallback)
  if(sounds.length < 20) {
    const moreQuery = 'subject:relaxing OR subject:relax';
    const more = await archiveSearch(moreQuery, 40).catch(()=>null);
    const ids = (more && more.response && more.response.docs) ? more.response.docs.map(d=>d.identifier) : [];
    await fillFromIds(ids, 20, 'Relax');
  }

  // Finally return up to 20
  return sounds.slice(0,20);
}

/* -------------------------
   UI init
   ------------------------- */
function renderArticles() {
  ARTICLES.forEach(a=>{
    const el = document.createElement('div');
    el.className = 'article-card';
    el.innerHTML = `<h3>${a.title}</h3><p>${a.excerpt}</p><button class="read-btn" data-id="${a.id}">Leer completo</button>`;
    articlesGrid.appendChild(el);
  });
}

/* Modal open */
function openArticle(id){
  const a = ARTICLES.find(x=>x.id===Number(id)); if(!a) return;
  modalTitle.textContent = a.title;
  modalBody.innerHTML = `<p style="margin-top:6px;color:#dffcff;line-height:1.6">${a.content}</p>`;
  modalRefs.innerHTML = `<strong>Referencias</strong><ul style="margin-top:8px">${a.refs.map(r=>`<li style="margin-bottom:6px;color:#bfeffd">${r}</li>`).join('')}</ul>`;
  modalBack.classList.add('on'); modalBack.setAttribute('aria-hidden','false'); window.scrollTo(0,0);
}
closeModal.addEventListener('click', ()=> { modalBack.classList.remove('on'); modalBack.setAttribute('aria-hidden','true'); });

document.addEventListener('click', (e)=>{
  const btn = e.target.closest('.read-btn');
  if(!btn) return;
  if(btn.dataset.id) { openArticle(btn.dataset.id); return; }
  if(btn.dataset.src) { const src = btn.dataset.src; audioPlayer.src = src; audioPlayer.play().catch(()=>{}); return; }
});

/* Subscription */
subForm.addEventListener('submit', (e)=>{
  e.preventDefault(); const email = (emailInput.value || '').trim();
  if(!email.includes('@')) { alert('Introduce un correo válido'); return; }
  localStorage.setItem('coralma_email', email); subInfo.textContent = `Suscrito: ${email} · Frase del mes: "${monthlyPhrase()}"`; subForm.style.display='none';
});
function monthlyPhrase(){ const arr=['Respira, estás donde debes.','Tu presencia es el acto más sanador.','Hoy es terreno fértil para la calma.','Suelta y respira.']; return arr[Math.floor(Math.random()*arr.length)]; }

/* Meditation timer & controls */
let timer = 0; let tick = null;
function setTimer(sec){ timer = sec; updateTime(); }
function updateTime(){ const mm = String(Math.floor(timer/60)).padStart(2,'0'); const ss = String(timer%60).padStart(2,'0'); timeDisplay.textContent = `${mm}:${ss}`; }
function startMeditation(){
  if(timer <= 0){ alert('Selecciona duración (5/10/15 min)'); return; }
  // ensure audio loaded
  audioPlayer.play().catch(()=>{ /* autoplay may be blocked, user interaction needed */ });
  medCircle.classList.remove('pulse'); medCircle.style.transform='scale(0.98)';
  startBtn.disabled = true; stopBtn.disabled = false;
  tick = setInterval(()=>{ if(timer>0){ timer--; updateTime(); } else { stopMeditation(); } },1000);
}
function stopMeditation(){
  audioPlayer.pause(); audioPlayer.currentTime = 0;
  medCircle.classList.add('pulse'); medCircle.style.transform='';
  startBtn.disabled = false; stopBtn.disabled = true;
  clearInterval(tick); tick = null;
}
medCircle.addEventListener('click', ()=> { if(!tick) startMeditation(); else stopMeditation(); });
startBtn.addEventListener('click', startMeditation);
stopBtn.addEventListener('click', stopMeditation);
soundSelect.addEventListener('change', ()=>{ const id = Number(soundSelect.value); const s = window.SOUNDS && window.SOUNDS.find(x=>x.id===id); if(s){ audioPlayer.src = s.src; }});
setTimer(300); updateTime();

/* WebView detection */
function isInAppBrowser(){
  const ua = navigator.userAgent || '';
  const apps = ['Instagram','FBAN','FBAV','Twitter','Line','MicroMessenger','TikTok','Snapchat'];
  return apps.some(a => ua.includes(a));
}
if(isInAppBrowser()){
  webviewBanner.style.display = 'block';
}
dismissWebview.addEventListener('click', ()=> webviewBanner.style.display='none');

/* Accessibility: close modal with Escape */
document.addEventListener('keydown', (e)=> { if(e.key === 'Escape'){ modalBack.classList.remove('on'); modalBack.setAttribute('aria-hidden','true'); } });

/* -------------------------
   Main init: render articles then build sounds dynamically
   ------------------------- */
async function init() {
  renderArticles();

  // load saved subscription
  const saved = localStorage.getItem('coralma_email');
  if(saved){ subInfo.textContent = `Suscrito: ${saved} · Frase del mes: "${monthlyPhrase()}"`; subForm.style.display='none'; }

  // Build sounds dynamically from archive.org
  try {
    const sounds = await buildSounds(); // returns array up to 20 elements
    // If none found (network blocked), fallback to an internal minimal list (silent placeholders)
    if(!sounds || sounds.length === 0) {
      soundsList.innerHTML = '<div style="color:#bfeffd">No fue posible obtener pistas desde archive.org. Conecta a Internet o abre en navegador normal.</div>';
      window.SOUNDS = [];
      return;
    }
    window.SOUNDS = sounds;
    // populate selector and list
    soundSelect.innerHTML = '';
    soundsList.innerHTML = '';
    sounds.forEach(s=>{
      const opt = document.createElement('option'); opt.value = s.id; opt.textContent = s.title; soundSelect.appendChild(opt);
      const row = document.createElement('div'); row.className = 'sound-item';
      row.innerHTML = `<div style="color:#dff8ff">${s.title}</div><div style="display:flex;gap:6px"><button class="read-btn" data-src="${s.src}">Play</button><button class="read-btn" data-id-play="${s.id}">Usar</button></div>`;
      soundsList.appendChild(row);
    });
    // default
    if(sounds[0]) { audioPlayer.src = sounds[0].src; soundSelect.value = 1; }
  } catch(err) {
    console.error('Error building sounds', err);
    soundsList.innerHTML = '<div style="color:#bfeffd">No se pudieron cargar las pistas automáticamente (bloqueo CORS o falta de conexión).</div>';
  }
}

// click handler for "Usar" from sounds list
document.addEventListener('click', (e)=>{
  const btnPlay = e.target.closest('[data-id-play]');
  if(btnPlay) {
    const id = Number(btnPlay.getAttribute('data-id-play'));
    const s = window.SOUNDS && window.SOUNDS.find(x=>x.id===id);
    if(s) { soundSelect.value = s.id; audioPlayer.src = s.src; audioPlayer.play().catch(()=>{}); }
  }
});

// initialize
init();

/* Note to user:
 - Archive.org is used so tracks "se autocarguen" y sean libres/public domain. Si quieres una lista fija de URLs (nombres concretos), dime y lo reemplazo por una selección verificada.
 - Recomendación: prueba primero en Chrome/Firefox en escritorio o móvil; algunos WebViews (Instagram/TikTok) bloquean peticiones o autoplay.
 */
</script>
</body>
</html>