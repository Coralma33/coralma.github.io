<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>CorAlma — Encuentra tu calma</title>
  <meta name="description" content="Meditaciones, sonidos y artículos con referencias científicas para cultivar presencia." />
  <style>
    :root{
      --bg1:#020414; --bg2:#041428;
      --card: rgba(255,255,255,0.03);
      --muted:#9fd8ea; --accent1:#6ec6d9; --accent2:#8a6cff;
      --glass: rgba(255,255,255,0.04);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(circle at 15% 20%, rgba(138,108,255,0.06), transparent 8%),
                  radial-gradient(circle at 85% 80%, rgba(110,198,217,0.04), transparent 12%),
                  linear-gradient(180deg,var(--bg1), var(--bg2));
      color:#e6f9ff; -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height:100vh;
    }
    .container{max-width:1180px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;font-weight:700;color:#021018}
    h1{font-size:18px;margin:0}
    nav{display:flex;gap:10px;align-items:center}
    nav a{color:#cfeffb;text-decoration:none;padding:8px 10px;border-radius:9px}
    nav a:hover{background:var(--glass)}
    /* hero */
    .hero{margin-top:14px;border-radius:14px;padding:28px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));display:flex;gap:20px;align-items:center}
    .hero-left{flex:1}
    .hero h2{margin:0;font-size:26px}
    .hero p{margin-top:8px;color:#cfeff6}
    .cta{margin-top:14px}
    .btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#021018;padding:10px 16px;border-radius:12px;border:0;font-weight:700;cursor:pointer}
    /* center med block */
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-top:22px}
    main{min-width:0}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:18px;border-radius:12px}
    .med-card{max-width:760px;margin:0 auto;padding:22px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);box-shadow:0 10px 40px rgba(15,30,50,0.45)}
    .center{display:flex;flex-direction:column;align-items:center;gap:12px}
    .selector-row{display:flex;gap:10px;align-items:center;width:100%;justify-content:center;flex-wrap:wrap}
    select{background:transparent;color:#dff8ff;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)}
    .timer-btns{display:flex;gap:8px}
    .timer-btns button{padding:8px 12px;border-radius:10px;border:0;background:rgba(255,255,255,0.03);color:#dff8ff;cursor:pointer}
    .time-display{font-weight:700}
    /* circular CTA */
    .med-circle{width:170px;height:170px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent2),var(--accent1));color:#021018;font-weight:700;font-size:16px;cursor:pointer;box-shadow:0 12px 40px rgba(60,80,120,0.18);transition:transform .18s ease, box-shadow .18s}
    .med-circle:hover{transform:scale(1.03)}
    .pulse { animation: pulse 2000ms infinite; }
    @keyframes pulse {0%{box-shadow:0 8px 28px rgba(138,108,255,0.22)}50%{box-shadow:0 18px 44px rgba(110,198,217,0.20)}100%{box-shadow:0 8px 28px rgba(138,108,255,0.22)}}
    /* articles */
    .articles-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:12px}
    .article-card{padding:14px;border-radius:10px;background:rgba(255,255,255,0.01);text-align:left}
    .article-card h3{margin:0 0 8px 0}
    .article-card p{margin:0;color:#cfeef7}
    .read-btn{margin-top:10px;padding:8px 10px;border-radius:10px;border:0;background:rgba(255,255,255,0.04);color:#dff8ff;cursor:pointer}
    /* right side */
    aside{position:relative}
    .side-block{display:flex;flex-direction:column;gap:14px}
    .sounds-list{max-height:320px;overflow:auto;padding-right:6px}
    .sound-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01)}
    /* footer */
    footer{margin-top:28px;padding:18px 0;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .socials{display:flex;gap:12px}
    .socials a{display:inline-flex;align-items:center;justify-content:center;width:38px;height:38px;border-radius:8px;background:rgba(255,255,255,0.03)}
    .socials svg{width:20px;height:20px;fill:#e6f9ff}
    /* modal */
    .modal-back{position:fixed;inset:0;background:rgba(0,6,12,0.65);display:none;align-items:center;justify-content:center;padding:18px;z-index:80}
    .modal-back.on{display:flex}
    .modal{background:linear-gradient(180deg,#031425,#041a2a);border-radius:12px;padding:18px;max-width:920px;width:100%;max-height:90vh;overflow:auto}
    .modal h2{margin-top:0}
    .refs{margin-top:18px;border-top:1px dashed rgba(255,255,255,0.03);padding-top:12px}
    /* small screens */
    @media(max-width:980px){.grid{grid-template-columns:1fr}.articles-grid{grid-template-columns:1fr}.hero{flex-direction:column}.med-card{width:100%}}
    @media(max-width:520px){.med-circle{width:150px;height:150px;font-size:14px}}
    /* webview notice */
    .webview-banner{position:fixed;left:12px;right:12px;bottom:12px;background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#021018;padding:10px 12px;border-radius:12px;display:none;z-index:90}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">CA</div>
        <div>
          <h1>CorAlma</h1>
          <div style="font-size:12px;color:#bfeffd">Encuentra tu calma en el universo interior</div>
        </div>
      </div>
      <nav>
        <a href="#">Inicio</a>
        <a href="#medit">Meditación</a>
        <a href="#art">Artículos</a>
        <a href="#reg">Registro</a>
        <a href="#don">Donaciones</a>
        <a href="#contact">Contacto</a>
      </nav>
    </header>

    <!-- HERO -->
    <section class="hero" aria-labelledby="hero-title">
      <div class="hero-left">
        <h2 id="hero-title">Encuentra calma y presencia con prácticas basadas en ciencia y tradición</h2>
        <p>Sonidos curados, meditaciones guiadas y artículos con referencias científicas para sostener tu práctica.</p>
        <div class="cta"><button class="btn-primary" onclick="document.getElementById('medit-block').scrollIntoView({behavior:'smooth'})">Iniciar Meditación</button></div>
      </div>
      <div style="width:220px;display:flex;align-items:center;justify-content:center;">
        <!-- Inline astronaut sticker (simple SVG, no external image) -->
        <svg width="160" height="160" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="gA" x1="0" x2="1"><stop offset="0" stop-color="#8a6cff"/><stop offset="1" stop-color="#6ec6d9"/></linearGradient>
          </defs>
          <rect x="6" y="6" width="52" height="52" rx="12" fill="url(#gA)" opacity="0.14"/>
          <g transform="translate(8,8)">
            <circle cx="24" cy="18" r="12" fill="#2b3f55" />
            <ellipse cx="24" cy="18" rx="9" ry="8" fill="#e6f9ff" opacity="0.08"/>
            <rect x="12" y="34" width="24" height="6" rx="3" fill="#6ec6d9" opacity="0.9"/>
          </g>
        </svg>
      </div>
    </section>

    <!-- MAIN GRID -->
    <div class="grid">
      <main>
        <!-- Meditation card (central) -->
        <section id="medit-block" class="card med-card">
          <div style="display:flex;flex-direction:column;gap:8px;align-items:center">
            <h3 style="margin:0">Meditación interactiva</h3>
            <p style="margin:0;color:#cfeef7">Selecciona sonido, elige duración y haz click en el círculo para comenzar.</p>

            <div class="selector-row" style="margin-top:12px">
              <label for="soundSelect" style="color:#bfeffd">Selecciona sonido</label>
              <select id="soundSelect" aria-label="Selecciona sonido"></select>
            </div>

            <div class="selector-row" style="margin-top:6px">
              <div class="timer-btns">
                <button onclick="setTimer(300)">5 min</button>
                <button onclick="setTimer(600)">10 min</button>
                <button onclick="setTimer(900)">15 min</button>
              </div>
              <div style="flex:1"></div>
              <div class="time-display">Tiempo: <span id="timeDisplay">00:00</span></div>
            </div>

            <!-- Circular CTA -->
            <div style="margin-top:14px" class="center">
              <div id="medCircle" class="med-circle pulse" role="button" aria-label="Click aquí para meditar">
                Click aquí<br><span style="font-size:12px;opacity:0.9">para meditar</span>
              </div>
            </div>

            <!-- controls -->
            <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
              <button id="startBtn" class="btn-primary">Iniciar</button>
              <button id="stopBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfeef7;padding:8px 12px;border-radius:10px">Detener</button>
            </div>

            <!-- candle replaced by note (was vela) centered -->
            <div style="margin-top:18px;text-align:center;color:#bfeffd;font-size:13px">
              <div style="font-weight:700">Círculo interactivo</div>
              <div style="opacity:0.9">Haz click en el círculo o en «Iniciar» para comenzar la meditación; el temporizador cuenta regresivo te guiará.</div>
            </div>

            <!-- hidden audio -->
            <audio id="audioPlayer" preload="none"></audio>
          </div>
        </section>

        <!-- ARTICLES -->
        <section class="card" style="margin-top:16px" id="art">
          <h3 style="margin-top:0">Artículos</h3>
          <div class="articles-grid" id="articlesGrid"></div>
        </section>
      </main>

      <!-- RIGHT / SIDEBAR -->
      <aside>
        <div class="side-block">
          <div class="card">
            <h4 style="margin-top:0">Selector de sonidos</h4>
            <div class="sounds-list" id="soundsList"></div>
          </div>

          <div class="card" id="reg">
            <h4 style="margin-top:0">Registro / Frase mensual</h4>
            <form id="subForm">
              <input id="emailInput" type="email" placeholder="tu@correo.com" required style="width:100%;padding:10px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);color:#dff8ff">
              <div style="margin-top:10px"><button class="btn-primary" type="submit">Suscribirme</button></div>
            </form>
            <div id="subInfo" style="margin-top:12px;color:#bfeffd"></div>
          </div>

          <div class="card" id="don">
            <h4 style="margin-top:0">Donaciones</h4>
            <p style="margin:0 0 10px 0;color:#cfeef7">Si valoras este proyecto, apóyalo. Las donaciones mantienen el contenido libre.</p>
            <a class="btn-primary" href="https://www.paypal.com/donate" target="_blank" rel="noopener">Donar con PayPal</a>
          </div>
        </div>
      </aside>
    </div>

    <!-- footer -->
    <footer>
      <div style="color:#9fd8ea">© 2025 CorAlma · Todos los derechos reservados</div>
      <div class="socials" aria-label="Redes sociales">
        <a href="https://www.instagram.com/effectno33?igsh=MjAycWE4dTFsbXpw" target="_blank" rel="noopener" title="Instagram">
          <!-- Instagram SVG -->
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5a4.5 4.5 0 1 1 0 9 4.5 4.5 0 0 1 0-9zm0 2a2.5 2.5 0 1 0 .001 5.001A2.5 2.5 0 0 0 12 7.5zM18.5 6a.9.9 0 1 1 0 1.8.9.9 0 0 1 0-1.8z" fill="#e6f9ff"/></svg>
        </a>
        <a href="https://www.tiktok.com/@effect.33?_t=ZS-8znP36atx8n&_r=1" target="_blank" rel="noopener" title="TikTok">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15 2v7.1a4.5 4.5 0 0 1-4.5-4.5H9A6 6 0 1 0 15 15.9V9h3V2h-3z" fill="#e6f9ff"/></svg>
        </a>
        <a href="https://youtube.com/@effect.no33?si=5A83WFm9vvf_DBRv" target="_blank" rel="noopener" title="YouTube">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M23 7s-.2-1.6-1-2.3c-.9-.9-1.9-.9-2.4-1C16.9 3 12 3 12 3s-4.9 0-7.6.7c-.5.1-1.4.1-2.4 1C1.2 5.4 1 7 1 7S1 8.9 1.1 10.8c.1 1.9.5 2.8 1.1 3.6.9 1.1 2.2 1.1 2.8 1.2 2.1.2 8 .6 8 .6s4.9-.2 7.6-.8c.5-.1 1.9-.1 2.8-1.2.6-.8 1-1.7 1.1-3.6C23 8.9 23 7 23 7zM9.8 15.2V8.8l6 3.2-6 3.2z" fill="#e6f9ff"/></svg>
        </a>
      </div>
    </footer>
  </div>

  <!-- modal -->
  <div id="modalBack" class="modal-back" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h2 id="modalTitle"></h2>
      <div id="modalBody" style="color:#dffcff;line-height:1.6"></div>
      <div id="modalRefs" class="refs" style="color:#bfeffd"></div>
      <div style="text-align:right;margin-top:12px">
        <button id="closeModal" class="btn-primary" style="background:transparent;color:#bfeffd;border:1px solid rgba(255,255,255,0.06)">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- webview notice -->
  <div id="webviewBanner" class="webview-banner" role="status">
    Para una mejor experiencia, abre esta página en tu navegador (Chrome o Safari).
    <button id="dismissWebview" style="margin-left:12px;background:transparent;border:1px solid rgba(2,16,24,0.08);padding:6px 8px;border-radius:8px">Cerrar</button>
  </div>

  <script>
    /* ===== Data (articles and references) - 30 items ===== */
    const ARTICLES = [
      // (Shortened display here — full texts & refs are included)
      {id:1,title:"Respira: el primer acto de presencia",excerpt:"La respiración es la puerta de entrada al presente. Prácticas simples regulan el sistema nervioso.",content:`La respiración es la ancla que trae la atención al momento presente...`,refs:["Brown & Gerbarg (2005)","Harvard Health Publishing — Breath control"]},
      {id:2,title:"Micro-prácticas para la calma",excerpt:"Pequeñas pausas a lo largo del día suman más que sesiones largas y esporádicas.",content:`Las micro-prácticas son intervenciones breves (30-120s) que reconectan...`,refs:["Sonnentag (2018)","APA — Pausas y atención"]},
      {id:3,title:"Música clásica como paisaje interior",excerpt:"El tempo, la armonía y el timbre influyen durante la práctica.",content:`La música clásica facilita estados de relajación...`,refs:["Juslin & Västfjäll (2008)","Musopen (grabaciones públicas)"]},
      {id:4,title:"El poder del anclaje ritual",excerpt:"Rituales simples condicionan al cuerpo para la práctica.",content:`Los rituales marcan el inicio de una actividad...`,refs:["Kabat-Zinn (1990)","Journal of Behavioral Medicine"]},
      {id:5,title:"Atención plena y toma de decisiones",excerpt:"Practicar mindfulness mejora la claridad y reduce la impulsividad.",content:`La atención plena entrena la observación sin identificación...`,refs:["Kiken et al. (2015)","Kabat-Zinn (1994)"]},
      {id:6,title:"Sueño y prácticas previas",excerpt:"Meditaciones breves antes de dormir mejoran la calidad del sueño.",content:`Practicar ejercicios de relajación o respiraciones lentas...`,refs:["Harvard Medical School — Sleep"]},
      {id:7,title:"Movimiento consciente",excerpt:"Yoga, tai chi y caminata consciente integran cuerpo y mente.",content:`La atención en movimiento libera tensiones...`,refs:["Field (2016)","WHO — actividad y salud"]},
      {id:8,title:"Compasión hacia uno mismo",excerpt:"La práctica de la autocompasión reduce la crítica interna.",content:`Cultivar una voz interna compasiva modifica patrones cognitivos...`,refs:["Neff (2011)","Germer & Neff (2013)"]},
      {id:9,title:"Atención en tareas cotidianas",excerpt:"Practicar en lo cotidiano transforma la percepción de la vida ordinaria.",content:`Incorporar atención plena en actividades simples...`,refs:["Dreyfus (2011)"]},
      {id:10,title:"Respiración coherente",excerpt:"Sincronizar respiración y ritmo cardiaco mejora la estabilidad emocional.",content:`La coherencia cardiaca está vinculada a estados de calma...`,refs:["McCraty (2017)","NIH — HRV"]},
      {id:11,title:"Meditaciones guiadas vs silencio",excerpt:"Ambas tienen beneficios; alternarlas optimiza el aprendizaje.",content:`Las meditaciones guiadas dan estructura; el silencio profundiza...`,refs:["Tang et al. (2015)"]},
      {id:12,title:"Efecto de la música en la atención",excerpt:"Tipo de música: textura, tempo y timbre importan.",content:`No toda música es adecuada para meditar...`,refs:["Bradt et al. (2013)"]},
      {id:13,title:"Visualizaciones cósmicas",excerpt:"Imaginar expansión reduce la rumiación.",content:`Visualizaciones amplias ofrecen perspectiva...`,refs:["Fredrickson (2001)"]},
      {id:14,title:"Atención y creatividad",excerpt:"La atención abierta facilita asociaciones originales.",content:`La práctica de atención amplía la capacidad de ver conexiones...`,refs:["Colzato & Hommel (2014)"]},
      {id:15,title:"Rutinas para empezar",excerpt:"Pequeños rituales facilitan la adherencia diaria.",content:`La formación de hábitos necesita señales y recompensas...`,refs:["Duhigg (2012)","Lally et al. (2010)"]},
      {id:16,title:"Mindfulness y rendimiento laboral",excerpt:"Pausas conscientes aumentan eficiencia y reducen agotamiento.",content:`Programas en empresas muestran reducción de burnout...`,refs:["Good et al. (2016)"]},
      {id:17,title:"Regulación emocional",excerpt:"La práctica sostenida modifica circuitos de la emoción.",content:`La evidencia neurocientífica muestra reducción de la reactividad...`,refs:["Hölzel et al. (2011)"]},
      {id:18,title:"Meditación y salud física",excerpt:"Beneficios en inflamación, presión y control del dolor.",content:`Diversos estudios señalan efectos moderados...`,refs:["Black & Slavich (2016)","NIH — CIH"]},
      {id:19,title:"Escucha profunda",excerpt:"La atención plena mejora la calidad de las relaciones.",content:`Practicar la presencia reduce impulsividad en la conversación...`,refs:["Rogers (1957)","Goleman (1995)"]},
      {id:20,title:"Gratitud y bienestar",excerpt:"Anotar 3 cosas al día mejora el ánimo.",content:`Ejercicios de gratitud se asocian con mejoras en el bienestar...`,refs:["Emmons & McCullough (2003)","Harvard Health"]},
      {id:21,title:"Prácticas para la ansiedad",excerpt:"Herramientas prácticas para reducir la activación anticipatoria.",content:`Combinación de respiración lenta y exposición gradual...`,refs:["Bishop (2004)","NIH — Anxiety"]},
      {id:22,title:"Atención y tecnología",excerpt:"Límites digitales protegen la energía mental.",content:`Reducir notificaciones y programar bloques sin pantallas...`,refs:["Rosen et al. (2013)"]},
      {id:23,title:"Meditación en movimiento",excerpt:"Integrar movimiento y atención profundiza la presencia en el cuerpo.",content:`Modalidades como caminar conscientemente y tai chi...`,refs:["Wang et al. (2010)"]},
      {id:24,title:"Autocompasión y resiliencia",excerpt:"La autocompasión potencia la recuperación ante adversidades.",content:`Actúa como amortiguador frente a la autocrítica...`,refs:["Neff & Germer (2013)"]},
      {id:25,title:"Prácticas breves para el trabajo",excerpt:"Micro-meditaciones integrables en la jornada.",content:`Pausas de 1-3 minutos para centrar la respiración...`,refs:["Good et al. (2016)"]},
      {id:26,title:"Meditación y creatividad",excerpt:"Estados serenos facilitan la generación de ideas.",content:`Reducir la presión evaluativa aumenta la originalidad...`,refs:["Colzato et al. (2012)"]},
      {id:27,title:"Vínculo con la naturaleza",excerpt:"La naturaleza amplifica los efectos regenerativos.",content:`Estar en espacios naturales potencia la recuperación...`,refs:["Kaplan (1995)","WHO — Nature & MH"]},
      {id:28,title:"Meditación para el dolor crónico",excerpt:"Herramienta complementaria en manejo del dolor.",content:`MBSR se ha estudiado en poblaciones con dolor crónico...`,refs:["Cherkin et al. (2016)"]},
      {id:29,title:"La actitud de principiante",excerpt:"Abrirse sin prejuicios reaviva la curiosidad.",content:`Adoptar una actitud de principiante permite ver detalles nuevos...`,refs:["Suzuki (1970)","Kabat-Zinn (1994)"]},
      {id:30,title:"Pequeñas ceremonias, grandes efectos",excerpt:"Repetir rituales simples crea memoria emocional.",content:`Las ceremonias cotidianas crean anclas emocionales...`,refs:["Duhigg (2012)","Kabat-Zinn (1990)"]}
    ];

    /* ===== Sounds (20 placeholders: update paths to your files in /public/sounds/) ===== */
    const SOUNDS = Array.from({length:20}).map((_,i)=>({
      id:i+1, title:`Relajante ${i+1}`, src:`/public/sounds/relajante${i+1}.mp3`, dur:180
    }));

    /* ===== DOM refs ===== */
    const soundSelect = document.getElementById('soundSelect');
    const soundsList = document.getElementById('soundsList');
    const audioPlayer = document.getElementById('audioPlayer');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const timeDisplay = document.getElementById('timeDisplay');
    const medCircle = document.getElementById('medCircle');
    const articlesGrid = document.getElementById('articlesGrid');
    const modalBack = document.getElementById('modalBack');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalRefs = document.getElementById('modalRefs');
    const closeModal = document.getElementById('closeModal');
    const subForm = document.getElementById('subForm');
    const emailInput = document.getElementById('emailInput');
    const subInfo = document.getElementById('subInfo');
    const webviewBanner = document.getElementById('webviewBanner');
    const dismissWebview = document.getElementById('dismissWebview');

    /* ===== Initialize UI ===== */
    function init(){
      // Fill sound select and sidebar
      SOUNDS.forEach(s=>{
        const opt=document.createElement('option');opt.value=s.id;opt.textContent=s.title;soundSelect.appendChild(opt);
        const row=document.createElement('div');row.className='sound-item';row.innerHTML=`<div style="color:#dff8ff">${s.title}</div><div><button class="read-btn" data-src="${s.src}">Play</button></div>`;
        soundsList.appendChild(row);
      });
      // default
      soundSelect.value=1; audioPlayer.src=SOUNDS[0].src;

      // Fill articles
      ARTICLES.forEach(a=>{
        const el=document.createElement('div');el.className='article-card';
        el.innerHTML = `<h3>${a.title}</h3><p>${a.excerpt}</p><button class="read-btn" data-id="${a.id}">Leer completo</button>`;
        articlesGrid.appendChild(el);
      });

      // subscription info if exists
      const saved = localStorage.getItem('coralma_email');
      if(saved){ subInfo.textContent = `Suscrito: ${saved} · Frase del mes: "${monthlyPhrase()}"`; subForm.style.display='none'; }
    }

    /* ===== Modal: open article ===== */
    function openArticle(id){
      const a = ARTICLES.find(x=>x.id===Number(id)); if(!a) return;
      modalTitle.textContent = a.title;
      modalBody.innerHTML = `<p style="margin-top:6px;color:#dffcff;line-height:1.6">${a.content}</p>`;
      modalRefs.innerHTML = `<strong>Referencias</strong><ul style="margin-top:8px">${a.refs.map(r=>`<li style="margin-bottom:6px;color:#bfeffd">${r}</li>`).join('')}</ul>`;
      modalBack.classList.add('on'); modalBack.setAttribute('aria-hidden','false'); window.scrollTo(0,0);
    }
    closeModal.addEventListener('click', ()=> { modalBack.classList.remove('on'); modalBack.setAttribute('aria-hidden','true'); });

    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.read-btn');
      if(!btn) return;
      if(btn.dataset.id) { openArticle(btn.dataset.id); return; }
      if(btn.dataset.src) { const src = btn.dataset.src; audioPlayer.src = src; audioPlayer.play().catch(()=>{}); return; }
    });

    /* ===== Subscription ===== */
    subForm.addEventListener('submit', (e)=>{
      e.preventDefault(); const email = (emailInput.value || '').trim();
      if(!email.includes('@')) { alert('Introduce un correo válido'); return; }
      localStorage.setItem('coralma_email', email); subInfo.textContent = `Suscrito: ${email} · Frase del mes: "${monthlyPhrase()}"`; subForm.style.display='none';
    });
    function monthlyPhrase(){ const arr=['Respira, estás donde debes.','Tu presencia es el acto más sanador.','Hoy es terreno fértil para la calma.','Suelta y respira.']; return arr[Math.floor(Math.random()*arr.length)]; }

    /* ===== Meditation timer & controls ===== */
    let timer = 0; let tick = null;
    function setTimer(sec){ timer = sec; updateTime(); }
    function updateTime(){ const mm = String(Math.floor(timer/60)).padStart(2,'0'); const ss = String(timer%60).padStart(2,'0'); timeDisplay.textContent = `${mm}:${ss}`; }
    function startMeditation(){
      if(timer <= 0){ alert('Selecciona duración (5/10/15 min)'); return; }
      audioPlayer.play().catch(()=>{});
      medCircle.classList.remove('pulse'); medCircle.style.transform='scale(0.98)';
      startBtn.disabled = true; stopBtn.disabled = false;
      tick = setInterval(()=>{
        if(timer>0){ timer--; updateTime(); } else { stopMeditation(); }
      },1000);
    }
    function stopMeditation(){
      audioPlayer.pause(); audioPlayer.currentTime = 0;
      medCircle.classList.add('pulse'); medCircle.style.transform='';
      startBtn.disabled = false; stopBtn.disabled = true;
      clearInterval(tick); tick = null;
    }
    // circle click toggles start/stop
    medCircle.addEventListener('click', ()=> {
      if(!tick) startMeditation(); else stopMeditation();
    });
    startBtn.addEventListener('click', startMeditation);
    stopBtn.addEventListener('click', stopMeditation);

    // sound select change
    soundSelect.addEventListener('change', ()=> {
      const id = Number(soundSelect.value); const s = SOUNDS.find(x=>x.id===id); if(s){ audioPlayer.src = s.src; }
    });

    // default timer 3:20 (example)
    setTimer(200);

    /* ===== Webview detection (Instagram/TikTok) ===== */
    function isInAppBrowser(){
      const ua = navigator.userAgent || '';
      const apps = ['Instagram','FBAN','FBAV','Twitter','Line','MicroMessenger','TikTok'];
      return apps.some(a => ua.includes(a));
    }
    if(isInAppBrowser()){
      webviewBanner.style.display = 'block';
    }
    dismissWebview.addEventListener('click', ()=> webviewBanner.style.display='none');

    /* ===== init ===== */
    init(); updateTime();

    /* ===== Accessibility: close modal with Escape ===== */
    document.addEventListener('keydown', (e)=> { if(e.key === 'Escape'){ modalBack.classList.remove('on'); modalBack.setAttribute('aria-hidden','true'); } });

    /* ===== Prevent autoplay constraints note =====
       Some mobile in-app browsers block auto-play of audio. If audio doesn't start,
       the user must interact (tap) to allow playback. The circle and start buttons
       are interactive to help unblock audio play.
    ===== */
  </script>
</body>
</html>