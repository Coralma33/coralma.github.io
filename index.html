<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>CorAlma — Encuentra tu calma</title>
<meta name="description" content="Meditaciones, sonidos y artículos dinámicos. Sonidos con fallback entre servidores." />
<style>
:root{
  --bg1:#020414; --bg2:#041428;
  --accent1:#6ec6d9; --accent2:#8a6cff;
  --glass: rgba(255,255,255,0.04);
  --muted:#9fd8ea;
  --text:#e6f9ff;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
body{
  background:
    radial-gradient(circle at 10% 10%, rgba(138,108,255,0.06), transparent 6%),
    radial-gradient(circle at 90% 70%, rgba(110,198,217,0.04), transparent 10%),
    linear-gradient(180deg,var(--bg1), var(--bg2));
  color:var(--text); -webkit-font-smoothing:antialiased;min-height:100vh;
}
.container{max-width:1180px;margin:24px auto;padding:18px}
header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;font-weight:700;color:#021018}
h1{font-size:18px;margin:0}
nav{display:flex;gap:10px;align-items:center}
nav a{color:#cfeffb;text-decoration:none;padding:8px 10px;border-radius:9px}
nav a:hover{background:var(--glass)}
.hero{margin-top:14px;border-radius:14px;padding:28px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));display:flex;gap:20px;align-items:center;position:relative;overflow:hidden}
.hero-left{flex:1;z-index:2}
.hero h2{margin:0;font-size:26px}
.hero p{margin-top:8px;color:#cfeef6}
.cta{margin-top:14px}
.btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#021018;padding:10px 16px;border-radius:12px;border:0;font-weight:700;cursor:pointer}
.hero-visual{width:260px;display:flex;align-items:center;justify-content:center;z-index:1}
.grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-top:22px}
main{min-width:0}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:18px;border-radius:12px}
.med-card{max-width:760px;margin:0 auto;padding:22px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);box-shadow:0 10px 40px rgba(15,30,50,0.45)}
.center{display:flex;flex-direction:column;align-items:center;gap:12px}
.selector-row{display:flex;gap:10px;align-items:center;width:100%;justify-content:center;flex-wrap:wrap}
select,input{background:transparent;color:#dff8ff;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)}
.timer-btns{display:flex;gap:8px}
.timer-btns button{padding:8px 12px;border-radius:10px;border:0;background:rgba(255,255,255,0.03);color:#dff8ff;cursor:pointer}
.time-display{font-weight:700}
.med-circle{width:170px;height:170px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent2),var(--accent1));color:#021018;font-weight:700;font-size:16px;cursor:pointer;box-shadow:0 12px 40px rgba(60,80,120,0.18);transition:transform .18s}
.med-circle:hover{transform:scale(1.03)}
.pulse { animation: pulse 2000ms infinite; }
@keyframes pulse {0%{box-shadow:0 8px 28px rgba(138,108,255,0.22)}50%{box-shadow:0 18px 44px rgba(110,198,217,0.20)}100%{box-shadow:0 8px 28px rgba(138,108,255,0.22)}}
.articles-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:12px;max-height:500px;overflow:auto}
.article-card{padding:14px;border-radius:10px;background:rgba(255,255,255,0.01);text-align:left}
.article-card h3{margin:0 0 6px 0;font-size:16px}
.article-card p{margin:0;color:#cfeef7;font-size:14px}
.read-btn{margin-top:6px;padding:6px 8px;border-radius:8px;border:0;background:rgba(255,255,255,0.04);color:#dff8ff;cursor:pointer;font-size:13px}
aside{position:relative}
.side-block{display:flex;flex-direction:column;gap:14px}
.sounds-list{max-height:320px;overflow:auto;padding-right:6px}
.sound-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01)}
.notice{font-size:13px;color:#ffd7a8;background:rgba(0,0,0,0.15);padding:8px;border-radius:8px;margin-top:8px}
footer{margin-top:28px;padding:18px 0;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
.socials{display:flex;gap:12px}
.socials a{display:inline-flex;align-items:center;justify-content:center;width:38px;height:38px;border-radius:8px;background:rgba(255,255,255,0.03)}
.socials svg{width:20px;height:20px;fill:#e6f9ff}
.floating-sidebar{position:fixed;right:12px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:10px;z-index:1000}
.floating-btn{width:44px;height:44px;border-radius:10px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .18s}
.floating-btn:hover{transform:scale(1.08);background:rgba(255,255,255,0.08)}
.youtube-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-top:14px}
.youtube-thumb{position:relative;cursor:pointer;border-radius:10px;overflow:hidden;background:#111;}
.youtube-thumb img{width:100%;display:block;}
.youtube-thumb .yt-title{position:absolute;bottom:0;left:0;width:100%;background:rgba(0,0,0,0.5);color:#fff;font-size:12px;padding:4px;text-align:center;}
.draggable{position:fixed;bottom:80px;right:20px;z-index:2000;cursor:move;}
iframe{border-radius:10px;width:100%;height:160px;}
@media(max-width:980px){.grid{grid-template-columns:1fr}.articles-grid{grid-template-columns:1fr}.hero{flex-direction:column}.med-card{width:100%}}
@media(max-width:520px){.med-circle{width:150px;height:150px;font-size:14px}}
button:focus, a:focus { outline: 2px dashed rgba(110,198,217,0.35); outline-offset: 3px; }
</style>
</head>
<body>
<div class="container">
<header>
<div class="brand">
<div class="logo">CA</div>
<div>
<h1>CorAlma</h1>
<div style="font-size:12px;color:#bfeffd">Encuentra tu calma en el universo interior</div>
</div>
</div>
<nav>
<a href="#">Inicio</a>
<a href="#medit-block">Meditación</a>
<a href="#art">Artículos</a>
<a href="#reg">Registro</a>
<a href="#don">Donaciones</a>
<a href="#contact">Contacto</a>
</nav>
</header>

<section class="hero" aria-labelledby="hero-title">
<div class="hero-left">
<h2 id="hero-title">Encuentra calma y presencia con prácticas basadas en ciencia y tradición</h2>
<p>Sonidos curados, meditaciones guiadas y artículos con referencias científicas para sostener tu práctica.</p>
<div class="cta"><button class="btn-primary" onclick="document.getElementById('medit-block').scrollIntoView({behavior:'smooth'})">Iniciar Meditación</button></div>
</div>
<div class="hero-visual" aria-hidden="true">
<!-- SVG visual -->
</div>
</section>

<div class="grid">
<main>
<section id="medit-block" class="card med-card">
<div style="display:flex;flex-direction:column;gap:8px;align-items:center">
<h3>Meditación interactiva</h3>
<p style="margin:0;color:#cfeef7">Selecciona sonido, elige duración y haz click en el círculo para comenzar.</p>
<div class="selector-row" style="margin-top:12px">
<label for="soundSelect" style="color:#bfeffd">Selecciona sonido</label>
<select id="soundSelect">
<option value="nature1.mp3">Lluvia suave</option>
<option value="nature2.mp3">Bosque</option>
<option value="nature3.mp3">Río</option>
</select>
</div>
<div class="selector-row" style="margin-top:6px">
<div class="timer-btns">
<button onclick="setTimer(300)">5 min</button>
<button onclick="setTimer(600)">10 min</button>
<button onclick="setTimer(900)">15 min</button>
</div>
<div style="flex:1"></div>
<div class="time-display" aria-live="polite">Tiempo: <span id="timeDisplay">00:00</span></div>
</div>
<div style="margin-top:14px" class="center">
<div id="medCircle" class="med-circle pulse" role="button" tabindex="0">Click aquí<br><span style="font-size:12px;opacity:0.9">para meditar</span></div>
</div>
<div style="margin-top:12px;display:flex;gap:12px;align-items:center">
<button id="startBtn" class="btn-primary">Iniciar</button>
<button id="stopBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfeef7;padding:8px 12px;border-radius:10px">Detener</button>
</div>
<div id="audioNotice" class="notice" style="display:none"></div>
<audio id="audioPlayer" preload="none" controls style="display:none"></audio>
</section>

<section class="card" id="art">
<h3>Artículos</h3>
<div class="articles-grid" id="articlesGrid"></div>
</section>

<section class="card">
<h3>Buscador de música (YouTube)</h3>
<div class="selector-row">
<input id="ytKeyword" type="text" placeholder="Escribe palabra clave..." style="flex:1">
<button class="btn-primary" onclick="searchYouTube()">Buscar</button>
</div>
<div class="youtube-container" id="youtubeResults"></div>
</section>
</main>

<aside>
<div class="side-block">
<div class="card">
<h4>Selector de sonidos</h4>
<div class="sounds-list" id="soundsList"></div>
</div>

<div class="card" id="reg">
<h4>Registro / Frase mensual</h4>
<form id="subForm">
<input id="emailInput" type="email" placeholder="tu@correo.com" required>
<div style="margin-top:10px"><button class="btn-primary" type="submit">Suscribirme</button></div>
</form>
<div id="subInfo" style="margin-top:12px;color:#bfeffd"></div>
</div>

<div class="card" id="don">
<h4>Donaciones</h4>
<p style="margin:0 0 10px 0;color:#cfeef7">Si valoras este proyecto, apóyalo. Las donaciones mantienen el contenido libre.</p>
<a class="btn-primary" href="https://www.paypal.com/donate" target="_blank" rel="noopener">Donar con PayPal</a>
</div>
</div>
</aside>
</div>

<footer id="contact">
<div style="color:#9fd8ea">Contacto: <a href="mailto:almacoralma@gmail.com">almacoralma@gmail.com</a></div>
<div class="socials" aria-label="Redes sociales">
<a href="https://www.instagram.com/effectno33" target="_blank">IG</a>
<a href="https://www.tiktok.com/@effect.33" target="_blank">TT</a>
<a href="https://youtube.com/@effect.no33" target="_blank">YT</a>
</div>
</footer>

<script>
const $ = id => document.getElementById(id);

/* ---------- Floating meditation button ---------- */
const medCircle = $('medCircle');
let timerSec = 300;
let timerInterval = null;
let audioPlayer = new Audio();
audioPlayer.loop = true;

function setTimer(sec){ timerSec=sec; updateDisplay(); }
function updateDisplay(){
  const m=Math.floor(timerSec/60).toString().padStart(2,'0');
  const s=(timerSec%60).toString().padStart(2,'0');
  $('timeDisplay').innerText=`${m}:${s}`;
}
function startTimer(){ 
  if(timerInterval) clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(timerSec>0){ timerSec--; updateDisplay(); } 
    else clearInterval(timerInterval);
  },1000);
}
function stopTimer(){ if(timerInterval) clearInterval(timerInterval); }

$('startBtn').onclick=()=>{ audioPlayer.play(); startTimer(); };
$('stopBtn').onclick=()=>{ audioPlayer.pause(); stopTimer(); };

/* ---------- Articles rotation ---------- */
const ARTICLES_KEY='articles'; const ARTICLES_DATE_KEY='articlesDate';
const MAX_ARTICLES=30;
async function fetchWikipediaTopics(){ return []; } // Implementar fetch real
async function fetchRedditPosts(){ return []; }
async function fetchArxiv(){ return []; }

async function loadArticles(){
  const lastDate=localStorage.getItem(ARTICLES_DATE_KEY);
  const now=new Date().getTime();
  if(!lastDate || now-lastDate>3*24*60*60*1000){
    const wiki=await fetchWikipediaTopics();
    const reddit=await fetchRedditPosts();
    const arxiv=await fetchArxiv();
    const combined=[...wiki,...reddit,...arxiv].slice(0,MAX_ARTICLES);
    localStorage.setItem(ARTICLES_KEY, JSON.stringify(combined));
    localStorage.setItem(ARTICLES_DATE_KEY, now.toString());
    renderArticles(combined);
  } else {
    const saved=JSON.parse(localStorage.getItem(ARTICLES_KEY)||'[]');
    renderArticles(saved);
  }
}
function renderArticles(articles){
  const grid=$('articlesGrid'); grid.innerHTML='';
  articles.forEach(a=>{
    const card=document.createElement('div');
    card.className='article-card';
    card.innerHTML=`
      <h3>${a.title.length>50 ? a.title.substring(0,47)+'...' : a.title}</h3>
      <p>${a.extract.length>150 ? a.extract.substring(0,147)+'...' : a.extract}</p>
      <div style="font-size:11px;color:#9fd8ea">Fuente: ${a.source}</div>
      <button class="read-btn" onclick="window.open('${a.url}','_blank')">Leer más</button>
    `;
    grid.appendChild(card);
  });
}

/* ---------- YouTube Recommendations ---------- */
const YT_RECS=[
  {title:'Relaxing Forest Sounds', videoId:'2OEL4P1Rz04'},
  {title:'Ocean Waves for Meditation', videoId:'VudJ_3R8F7A'},
  {title:'Rain Sounds Nature', videoId:'qMiwb7cR3pE'},
  {title:'Mountain Stream', videoId:'5qap5aO4i9A'},
  {title:'Jungle Ambience', videoId:'OdIJ2x3nxzQ'}
];
function renderYTRecs(){
  const list=$('soundsList'); list.innerHTML='';
  YT_RECS.forEach(r=>{
    const item=document.createElement('div');
    item.className='sound-item';
    item.innerHTML=`
      <div>${r.title.length>30?r.title.substring(0,27)+'...':r.title}</div>
      <button onclick="playYTIframe('${r.videoId}')">▶️</button>
      <button onclick="stopYTIframe()">⏹️</button>
    `;
    list.appendChild(item);
  });
}
function playYTIframe(videoId){
  let iframe=$('ytPlayer');
  if(!iframe){
    iframe=document.createElement('iframe');
    iframe.id='ytPlayer';
    iframe.allow='autoplay; encrypted-media';
iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1`;
    iframe.style.width='100%';
    iframe.style.height='160px';
    document.getElementById('youtubeResults').appendChild(iframe);
  } else {
    iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1`;
  }
}
function stopYTIframe(){
  const iframe = $('ytPlayer');
  if(iframe) iframe.src='';
}

/* ---------- Floating draggable meditation ---------- */
const floating = document.createElement('div');
floating.className='draggable';
floating.style.width='160px';
floating.style.height='160px';
floating.style.background='linear-gradient(135deg,#8a6cff,#6ec6d9)';
floating.style.borderRadius='50%';
floating.style.color='#021018';
floating.style.fontWeight='700';
floating.style.fontSize='14px';
floating.style.display='flex';
floating.style.flexDirection='column';
floating.style.alignItems='center';
floating.style.justifyContent='center';
floating.style.boxShadow='0 12px 40px rgba(60,80,120,0.18)';
floating.innerHTML='Click aquí<br><span style="font-size:12px;opacity:0.9">para meditar</span>';
document.body.appendChild(floating);

let isDragging=false, offsetX=0, offsetY=0;
floating.onmousedown=(e)=>{
  isDragging=true;
  offsetX=e.clientX-floating.offsetLeft;
  offsetY=e.clientY-floating.offsetTop;
};
document.onmousemove=(e)=>{
  if(isDragging){
    floating.style.left=(e.clientX-offsetX)+'px';
    floating.style.top=(e.clientY-offsetY)+'px';
  }
};
document.onmouseup=()=>{ isDragging=false; };
floating.onclick=()=>{
  audioPlayer.play();
  startTimer();
};

/* ---------- Subscription form ---------- */
$('subForm').onsubmit=(e)=>{
  e.preventDefault();
  $('subInfo').innerText='Gracias por suscribirte!';
  $('emailInput').value='';
};

/* ---------- Initialization ---------- */
updateDisplay();
loadArticles();
renderYTRecs();
</script>
</body>
</html>